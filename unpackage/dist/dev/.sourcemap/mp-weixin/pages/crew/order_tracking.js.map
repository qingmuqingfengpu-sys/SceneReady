{"version":3,"sources":["uni-app:///main.js","webpack:///D:/SceneReady/SceneReady-main/pages/crew/order_tracking.vue?54bc","webpack:///D:/SceneReady/SceneReady-main/pages/crew/order_tracking.vue?6936","webpack:///D:/SceneReady/SceneReady-main/pages/crew/order_tracking.vue?a32e","webpack:///D:/SceneReady/SceneReady-main/pages/crew/order_tracking.vue?984a","uni-app:///pages/crew/order_tracking.vue","webpack:///D:/SceneReady/SceneReady-main/pages/crew/order_tracking.vue?5c9b","webpack:///D:/SceneReady/SceneReady-main/pages/crew/order_tracking.vue?e4e1"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","orderId","order","actorInfo","mapCenter","latitude","longitude","mapScale","markers","polyline","circles","trackList","actorLocation","meetingLocation","isOnline","refreshTimer","statusText","distanceText","trackingStarted","orderIssues","hasNewIssue","computed","canConfirmArrival","onLoad","onUnload","methods","loadOrderInfo","db","res","console","uni","title","icon","loadActorInfo","nickname","avatar","mobile","loadTracks","where","order_id","orderBy","limit","get","latestTrack","loadOrderIssues","oldCount","showIssueNotification","content","showCancel","confirmText","getIssueTypeText","updateMapElements","newMarkers","id","iconPath","width","height","anchor","x","y","callout","display","bgColor","color","fontSize","borderRadius","padding","newCircles","radius","fillColor","strokeWidth","filter","map","reverse","points","dottedLine","arrowLine","calculateDistance","getDistance","Math","getTrackDesc","formatDateTime","formatTime","startRefreshTimer","tracking_started","order_status","arrive_time","orderData","stopRefreshTimer","clearInterval","onMarkerTap","callActor","phoneNumber","messageActor","goToDetail","url","confirmArrival","success","mask","orderCo","result","setTimeout","completeOrder"],"mappings":";;;;;;;;;;;;;AAAA;AAE2D;AAC3D;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,uBAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAuI;AACvI;AACkE;AACL;AACsC;;;AAGnG;AAC6L;AAC7L,gBAAgB,uMAAU;AAC1B,EAAE,oFAAM;AACR,EAAE,qGAAM;AACR,EAAE,8GAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,yGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,sTAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC1DA;AAAA;AAAA;AAAA;AAA6uB,CAAgB,0vBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eCmFjwB;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;QACAC;QACAC;MACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EAEAC;IACAC;MACA;MACA;IACA;EACA;EAEAC;IACA;MACA;MACA;MACA;IACA;EACA;EAEAC;IACA;EACA;EAEAC;IACAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEAC;gBAAA;gBAAA,OACAA;cAAA;gBAAAC;gBAAA,MAEAA;kBAAA;kBAAA;gBAAA;gBACA;;gBAEA;gBACA;gBACA;kBACA;kBACA;gBACA;;gBAEA;gBACA;kBACA;oBACAvB;oBACAC;kBACA;kBACA;kBACA;gBACA;;gBAEA;gBAAA,KACA;kBAAA;kBAAA;gBAAA;gBAAA;gBAAA,OACA;cAAA;gBAAA,KAIA;kBAAA;kBAAA;gBAAA;gBAAA;gBAAA,OACA;cAAA;gBAAA;gBAAA,OAIA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAGAuB;gBACAC;kBACAC;kBACAC;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEAN;gBAAA;gBAAA,OACAA;kBACAO;kBACAC;kBACAC;gBACA;cAAA;gBAJAR;gBAMA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAC;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEAQ;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEAV;gBAAA;gBAAA,OACAA,8BACAW;kBAAAC;gBAAA,GACAC,+BACAC,UACAC;cAAA;gBAJAd;gBAMA;kBACA;;kBAEA;kBACA;oBACAe;oBACA;sBACA;wBACAtC;wBACAC;sBACA;sBACA;sBACA;sBACA;oBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAuB;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEAe;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEAjB;gBAAA;gBAAA,OACAA,8BACAW;kBAAAC;gBAAA,GACAC,+BACAE;cAAA;gBAHAd;gBAKA;kBACAiB;kBACA;;kBAEA;kBACA;oBACA;oBACA;kBACA;oBACA;oBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAhB;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEAiB;MACA;QACA;QACA;QACA;QACA;MACA;MACA;MACAhB;QACAC;QACAgB;QACAC;QACAC;MACA;IACA;IAEAC;MACA;QACA;QACA;QACA;QACA;MACA;MACA;IACA;IAEAC;MACA;MACA;;MAEA;MACA;QACAC;UACAC;UACAhD;UACAC;UACAgD;UACAC;UACAC;UACAC;YAAAC;YAAAC;UAAA;UACAC;YACAb;YACAc;YACAC;YACAC;YACAC;YACAC;YACAC;UACA;QACA;;QAEA;QACAC;UACA9D;UACAC;UACA8D;UACAL;UACAM;UACAC;QACA;MACA;;MAEA;MACA;QACAlB;UACAC;UACAhD;UACAC;UACAgD;UACAC;UACAC;UACAC;YAAAC;YAAAC;UAAA;UACAC;YACAb;YACAc;YACAC;YACAC;YACAC;YACAC;YACAC;UACA;QACA;;QAEA;QACA;UACA,4BACAK;YAAA;UAAA,GACAC;YAAA;cACAnE;cACAC;YACA;UAAA,GACAmE;UAEA;YACA;cACAC;cACAX;cACAR;cACAoB;cACAC;YACA;UACA;QACA;MACA;MAEA;MACA;IACA;IAEAC;MACA;QACA;QACA;MACA;MAEA,gCACA,6BACA,8BACA,+BACA,+BACA;MAEA;QACA;QACA;MACA;QACA;QACA;MACA;QACA;QACA;MACA;IACA;IAEAC;MACA;MACA;MACA;MACA,QACAC,0CACAA,iCACAA,iCACAA;MACA;MACA;IACA;IAEAC;MACA;QACA;MACA;QACA;MACA;MACA;IACA;IAEAC;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IAEAC;MACA;MACA;MACA;MACA;MACA;IACA;IAEAC;MAAA;MACA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAGAxD;gBAAA;gBAAA,OACAA;kBACAyD;kBACAC;kBACAC;gBACA;cAAA;gBAJA1D;gBAMA;kBACA2D;kBACA;kBACA;;kBAEA;kBACA;oBACA;oBACA;oBACAzD;sBACAC;sBACAC;oBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAH;cAAA;gBAGA;gBACA;kBACA;gBACA;;gBAEA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,CACA;IACA;IAEA2D;MACA;QACAC;QACA;MACA;IACA;IAEAC;MACA;MACA;QACA;QACA5D;UACAC;UACAC;QACA;MACA;QACA;QACAF;UACAC;UACAC;QACA;MACA;IACA;IAEA2D;MACA;QACA7D;UACA8D;QACA;MACA;QACA9D;UACAC;UACAC;QACA;MACA;IACA;IAEA6D;MACA;MACA/D;QACAC;QACAC;MACA;IACA;IAEA8D;MACAhE;QACAiE;MACA;IACA;IAEAC;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;gBACAlE;kBACAC;kBACAgB;kBACAkD;oBAAA;sBAAA;sBAAA;wBAAA;0BAAA;4BAAA;8BAAA,KACArE;gCAAA;gCAAA;8BAAA;8BAAA;8BAEAE;gCAAAC;gCAAAmE;8BAAA;8BACAC;8BAAA;8BAAA,OACAA;4BAAA;8BAAAC;8BACAtE;8BAEA;gCACAA;kCACAC;kCACAC;gCACA;gCACA;gCACAqE;kCACAvE;oCACAiE;kCACA;gCACA;8BACA;gCACAjE;kCACAC;kCACAC;gCACA;8BACA;8BAAA;8BAAA;4BAAA;8BAAA;8BAAA;8BAEAF;8BACAD;8BACAC;gCACAC;gCACAC;8BACA;4BAAA;4BAAA;8BAAA;0BAAA;wBAAA;sBAAA;oBAAA,CAGA;oBAAA;sBAAA;oBAAA;oBAAA;kBAAA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAEAsE;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;gBACA;kBACAxE;oBACAC;oBACAgB;oBACAkD;sBAAA;wBAAA;0BAAA;4BAAA;8BAAA;gCACA;kCACA;kCACAnE;oCACAC;oCACAC;kCACA;kCACAqE;oCACAvE;sCACAiE;oCACA;kCACA;gCACA;8BAAA;8BAAA;gCAAA;4BAAA;0BAAA;wBAAA;sBAAA,CACA;sBAAA;wBAAA;sBAAA;sBAAA;oBAAA;kBACA;gBACA;kBACAlE;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;ACvkBA;AAAA;AAAA;AAAA;AAAw5C,CAAgB,y2CAAG,EAAC,C;;;;;;;;;;;ACA56C;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/crew/order_tracking.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './pages/crew/order_tracking.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./order_tracking.vue?vue&type=template&id=1474fde6&scoped=true&\"\nvar renderjs\nimport script from \"./order_tracking.vue?vue&type=script&lang=js&\"\nexport * from \"./order_tracking.vue?vue&type=script&lang=js&\"\nimport style0 from \"./order_tracking.vue?vue&type=style&index=0&id=1474fde6&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"1474fde6\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/crew/order_tracking.vue\"\nexport default component.exports","export * from \"-!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./order_tracking.vue?vue&type=template&id=1474fde6&scoped=true&\"","var components\ntry {\n  components = {\n    uniIcons: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-icons/components/uni-icons/uni-icons\" */ \"@/uni_modules/uni-icons/components/uni-icons/uni-icons.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var m0 = _vm.formatDateTime(_vm.order.work_start_time) || \"工作时间\"\n  var g0 = _vm.orderIssues.length\n  var l0 =\n    g0 > 0\n      ? _vm.__map(_vm.orderIssues, function (issue, __i0__) {\n          var $orig = _vm.__get_orig(issue)\n          var m1 = _vm.getIssueTypeText(issue.issue_type)\n          var m2 = _vm.formatTime(issue.report_time)\n          return {\n            $orig: $orig,\n            m1: m1,\n            m2: m2,\n          }\n        })\n      : null\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        m0: m0,\n        g0: g0,\n        l0: l0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./order_tracking.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./order_tracking.vue?vue&type=script&lang=js&\"","<template>\n  <view class=\"tracking-page\">\n    <!-- 地图区域 -->\n    <map\n      id=\"trackingMap\"\n      class=\"tracking-map\"\n      :latitude=\"mapCenter.latitude\"\n      :longitude=\"mapCenter.longitude\"\n      :scale=\"mapScale\"\n      :markers=\"markers\"\n      :polyline=\"polyline\"\n      :circles=\"circles\"\n      :show-location=\"false\"\n      @markertap=\"onMarkerTap\"\n    >\n      <!-- 状态信息覆盖层 -->\n      <cover-view class=\"status-overlay\">\n        <cover-view class=\"status-card-cover\">\n          <cover-view class=\"status-title\">{{ statusText }}</cover-view>\n          <cover-view class=\"status-distance\">{{ distanceText }}</cover-view>\n        </cover-view>\n      </cover-view>\n    </map>\n\n    <!-- 底部信息面板 -->\n    <view class=\"info-panel\">\n      <!-- 演员信息 -->\n      <view class=\"actor-info-section\">\n        <image class=\"actor-avatar\" :src=\"actorInfo.avatar || '/static/default-avatar.png'\" mode=\"aspectFill\"></image>\n        <view class=\"actor-detail\">\n          <text class=\"actor-name\">{{ actorInfo.nickname || '演员' }}</text>\n          <view class=\"actor-status\">\n            <view class=\"online-dot\" :class=\"{ online: isOnline }\"></view>\n            <text class=\"status-text\">{{ isOnline ? '在线' : '离线' }}</text>\n          </view>\n        </view>\n        <view class=\"action-buttons-small\">\n          <view class=\"action-btn\" @tap=\"callActor\">\n            <uni-icons type=\"phone\" size=\"24\" color=\"#FFD700\"></uni-icons>\n          </view>\n          <view class=\"action-btn\" @tap=\"messageActor\">\n            <uni-icons type=\"chat\" size=\"24\" color=\"#FFD700\"></uni-icons>\n          </view>\n        </view>\n      </view>\n\n      <!-- 订单信息 -->\n      <view class=\"order-info-section\">\n        <view class=\"info-item\">\n          <uni-icons type=\"location\" size=\"20\" color=\"#999\"></uni-icons>\n          <text class=\"info-text\">{{ order.meeting_location_name || '集合地点' }}</text>\n        </view>\n        <view class=\"info-item\">\n          <uni-icons type=\"calendar\" size=\"20\" color=\"#999\"></uni-icons>\n          <text class=\"info-text\">{{ formatDateTime(order.work_start_time) || '工作时间' }}</text>\n        </view>\n      </view>\n\n      <!-- 问题上报列表 -->\n      <view class=\"issue-section\" v-if=\"orderIssues.length > 0\">\n        <view class=\"issue-header\">\n          <uni-icons type=\"info\" size=\"18\" color=\"#FF6B6B\"></uni-icons>\n          <text class=\"issue-title\">演员问题上报</text>\n        </view>\n        <view class=\"issue-list\">\n          <view class=\"issue-item\" v-for=\"issue in orderIssues\" :key=\"issue._id\">\n            <view class=\"issue-type-tag\" :class=\"issue.issue_type\">{{ getIssueTypeText(issue.issue_type) }}</view>\n            <text class=\"issue-desc\" v-if=\"issue.issue_description\">{{ issue.issue_description }}</text>\n            <text class=\"issue-time\">{{ formatTime(issue.report_time) }}</text>\n          </view>\n        </view>\n      </view>\n\n      <!-- 操作按钮 -->\n      <view class=\"bottom-actions\">\n        <button class=\"btn-secondary\" @tap=\"goToDetail\">查看订单</button>\n        <button class=\"btn-primary\" @tap=\"confirmArrival\" v-if=\"canConfirmArrival\">确认完成</button>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      orderId: '',\n      order: {},\n      actorInfo: {},\n      mapCenter: {\n        latitude: 29.5630,\n        longitude: 106.4650\n      },\n      mapScale: 15,\n      markers: [],\n      polyline: [],\n      circles: [],\n      trackList: [],\n      actorLocation: null,\n      meetingLocation: null,\n      isOnline: false,\n      refreshTimer: null,\n      statusText: '等待演员出发',\n      distanceText: '距离计算中...',\n      trackingStarted: false,\n      orderIssues: [],\n      hasNewIssue: false\n    }\n  },\n\n  computed: {\n    canConfirmArrival() {\n      // 订单进行中且演员已打卡时可以确认完成\n      return this.order.order_status === 1 && this.order.arrive_time\n    }\n  },\n\n  onLoad(options) {\n    if (options.id) {\n      this.orderId = options.id\n      this.loadOrderInfo()\n      this.startRefreshTimer()\n    }\n  },\n\n  onUnload() {\n    this.stopRefreshTimer()\n  },\n\n  methods: {\n    async loadOrderInfo() {\n      try {\n        const db = uniCloud.database()\n        const res = await db.collection('orders').doc(this.orderId).get()\n\n        if (res.result.data && res.result.data.length > 0) {\n          this.order = res.result.data[0]\n\n          // 检查追踪状态\n          this.trackingStarted = this.order.tracking_started === true\n          if (!this.trackingStarted) {\n            this.statusText = '等待演员出发'\n            this.distanceText = '演员尚未点击\"我已出发\"'\n          }\n\n          // 设置集合地点\n          if (this.order.meeting_location) {\n            this.meetingLocation = {\n              latitude: this.order.meeting_location.coordinates[1],\n              longitude: this.order.meeting_location.coordinates[0]\n            }\n            this.mapCenter = { ...this.meetingLocation }\n            this.updateMapElements()\n          }\n\n          // 加载演员信息\n          if (this.order.receiver_id) {\n            await this.loadActorInfo(this.order.receiver_id)\n          }\n\n          // 加载轨迹（只有演员出发后才有轨迹）\n          if (this.trackingStarted) {\n            await this.loadTracks()\n          }\n\n          // 加载问题上报\n          await this.loadOrderIssues()\n        }\n      } catch (error) {\n        console.error('加载订单信息失败:', error)\n        uni.showToast({\n          title: '加载失败',\n          icon: 'none'\n        })\n      }\n    },\n\n    async loadActorInfo(actorId) {\n      try {\n        const db = uniCloud.database()\n        const res = await db.collection('uni-id-users').doc(actorId).field({\n          nickname: true,\n          avatar: true,\n          mobile: true\n        }).get()\n\n        if (res.result.data && res.result.data.length > 0) {\n          this.actorInfo = res.result.data[0]\n        }\n      } catch (error) {\n        console.error('加载演员信息失败:', error)\n      }\n    },\n\n    async loadTracks() {\n      try {\n        const db = uniCloud.database()\n        const res = await db.collection('order_tracks')\n          .where({ order_id: this.orderId })\n          .orderBy('create_time', 'desc')\n          .limit(20)\n          .get()\n\n        if (res.result.data) {\n          this.trackList = res.result.data\n\n          // 如果有轨迹，更新演员位置\n          if (this.trackList.length > 0) {\n            const latestTrack = this.trackList[0]\n            if (latestTrack.location) {\n              this.actorLocation = {\n                latitude: latestTrack.location.coordinates[1],\n                longitude: latestTrack.location.coordinates[0]\n              }\n              this.isOnline = Date.now() - latestTrack.create_time < 60000 // 1分钟内有更新认为在线\n              this.updateMapElements()\n              this.calculateDistance()\n            }\n          }\n        }\n      } catch (error) {\n        console.error('加载轨迹失败:', error)\n      }\n    },\n\n    async loadOrderIssues() {\n      try {\n        const db = uniCloud.database()\n        const res = await db.collection('order_issues')\n          .where({ order_id: this.orderId })\n          .orderBy('report_time', 'desc')\n          .get()\n\n        if (res.result.data) {\n          const oldCount = this.orderIssues.length\n          this.orderIssues = res.result.data\n\n          // 检测是否有新问题\n          if (this.orderIssues.length > oldCount && oldCount > 0) {\n            this.hasNewIssue = true\n            this.showIssueNotification(this.orderIssues[0])\n          } else if (this.orderIssues.length > 0 && oldCount === 0) {\n            // 首次加载时如果有问题也提示\n            this.showIssueNotification(this.orderIssues[0])\n          }\n        }\n      } catch (error) {\n        console.error('加载问题上报失败:', error)\n      }\n    },\n\n    showIssueNotification(issue) {\n      const issueTypeMap = {\n        'late_warning': '迟到预警',\n        'cannot_arrive': '无法到达',\n        'safety_issue': '安全问题',\n        'other': '其他问题'\n      }\n      const typeName = issueTypeMap[issue.issue_type] || '问题上报'\n      uni.showModal({\n        title: '演员问题上报',\n        content: `${typeName}${issue.issue_description ? '：' + issue.issue_description : ''}`,\n        showCancel: false,\n        confirmText: '知道了'\n      })\n    },\n\n    getIssueTypeText(type) {\n      const typeMap = {\n        'late_warning': '迟到预警',\n        'cannot_arrive': '无法到达',\n        'safety_issue': '安全问题',\n        'other': '其他问题'\n      }\n      return typeMap[type] || '未知'\n    },\n\n    updateMapElements() {\n      const newMarkers = []\n      const newCircles = []\n\n      // 集合地点标记\n      if (this.meetingLocation) {\n        newMarkers.push({\n          id: 1,\n          latitude: this.meetingLocation.latitude,\n          longitude: this.meetingLocation.longitude,\n          iconPath: '/static/icons/location-meeting.png',\n          width: 40,\n          height: 40,\n          anchor: { x: 0.5, y: 1 },\n          callout: {\n            content: '集合地点',\n            display: 'ALWAYS',\n            bgColor: '#1E1E1E',\n            color: '#FFD700',\n            fontSize: 12,\n            borderRadius: 8,\n            padding: 8\n          }\n        })\n\n        // 电子围栏（100米）\n        newCircles.push({\n          latitude: this.meetingLocation.latitude,\n          longitude: this.meetingLocation.longitude,\n          radius: 100,\n          color: '#FFD70050',\n          fillColor: '#FFD70020',\n          strokeWidth: 2\n        })\n      }\n\n      // 演员位置标记\n      if (this.actorLocation) {\n        newMarkers.push({\n          id: 2,\n          latitude: this.actorLocation.latitude,\n          longitude: this.actorLocation.longitude,\n          iconPath: this.actorInfo.avatar || '/static/default-avatar.png',\n          width: 50,\n          height: 50,\n          anchor: { x: 0.5, y: 0.5 },\n          callout: {\n            content: this.actorInfo.nickname || '演员',\n            display: 'ALWAYS',\n            bgColor: '#1E1E1E',\n            color: '#FFFFFF',\n            fontSize: 12,\n            borderRadius: 8,\n            padding: 8\n          }\n        })\n\n        // 绘制轨迹线\n        if (this.trackList.length > 1) {\n          const points = this.trackList\n            .filter(t => t.location)\n            .map(t => ({\n              latitude: t.location.coordinates[1],\n              longitude: t.location.coordinates[0]\n            }))\n            .reverse()\n\n          if (points.length > 1) {\n            this.polyline = [{\n              points: points,\n              color: '#2979FF',\n              width: 4,\n              dottedLine: false,\n              arrowLine: true\n            }]\n          }\n        }\n      }\n\n      this.markers = newMarkers\n      this.circles = newCircles\n    },\n\n    calculateDistance() {\n      if (!this.actorLocation || !this.meetingLocation) {\n        this.distanceText = '距离计算中...'\n        return\n      }\n\n      const distance = this.getDistance(\n        this.actorLocation.latitude,\n        this.actorLocation.longitude,\n        this.meetingLocation.latitude,\n        this.meetingLocation.longitude\n      )\n\n      if (distance < 100) {\n        this.statusText = '演员已到达'\n        this.distanceText = '已在集合地点附近'\n      } else if (distance < 1000) {\n        this.statusText = '演员正在赶来'\n        this.distanceText = `距离集合地点 ${Math.round(distance)}米`\n      } else {\n        this.statusText = '演员正在赶来'\n        this.distanceText = `距离集合地点 ${(distance / 1000).toFixed(1)}公里`\n      }\n    },\n\n    getDistance(lat1, lng1, lat2, lng2) {\n      const R = 6371000\n      const dLat = (lat2 - lat1) * Math.PI / 180\n      const dLng = (lng2 - lng1) * Math.PI / 180\n      const a =\n        Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n        Math.cos(lat1 * Math.PI / 180) *\n        Math.cos(lat2 * Math.PI / 180) *\n        Math.sin(dLng / 2) * Math.sin(dLng / 2)\n      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))\n      return R * c\n    },\n\n    getTrackDesc(track) {\n      if (track.track_type === 'check_in') {\n        return '演员已打卡签到'\n      } else if (track.track_type === 'location') {\n        return '位置更新'\n      }\n      return '轨迹记录'\n    },\n\n    formatDateTime(timestamp) {\n      if (!timestamp) return ''\n      const date = new Date(timestamp)\n      const month = String(date.getMonth() + 1).padStart(2, '0')\n      const day = String(date.getDate()).padStart(2, '0')\n      const hour = String(date.getHours()).padStart(2, '0')\n      const minute = String(date.getMinutes()).padStart(2, '0')\n      return `${month}-${day} ${hour}:${minute}`\n    },\n\n    formatTime(timestamp) {\n      if (!timestamp) return ''\n      const date = new Date(timestamp)\n      const hour = String(date.getHours()).padStart(2, '0')\n      const minute = String(date.getMinutes()).padStart(2, '0')\n      return `${hour}:${minute}`\n    },\n\n    startRefreshTimer() {\n      this.refreshTimer = setInterval(async () => {\n        // 刷新订单状态（检查追踪是否开始）\n        try {\n          const db = uniCloud.database()\n          const res = await db.collection('orders').doc(this.orderId).field({\n            tracking_started: true,\n            order_status: true,\n            arrive_time: true\n          }).get()\n\n          if (res.result.data && res.result.data.length > 0) {\n            const orderData = res.result.data[0]\n            this.order.order_status = orderData.order_status\n            this.order.arrive_time = orderData.arrive_time\n\n            // 检查追踪状态变化\n            if (orderData.tracking_started && !this.trackingStarted) {\n              this.trackingStarted = true\n              this.order.tracking_started = true\n              uni.showToast({\n                title: '演员已出发',\n                icon: 'none'\n              })\n            }\n          }\n        } catch (error) {\n          console.error('刷新订单状态失败:', error)\n        }\n\n        // 加载轨迹（仅在已开始追踪时）\n        if (this.trackingStarted) {\n          this.loadTracks()\n        }\n\n        // 加载问题上报\n        this.loadOrderIssues()\n      }, 10000) // 每10秒刷新一次\n    },\n\n    stopRefreshTimer() {\n      if (this.refreshTimer) {\n        clearInterval(this.refreshTimer)\n        this.refreshTimer = null\n      }\n    },\n\n    onMarkerTap(e) {\n      const markerId = e.detail.markerId\n      if (markerId === 1) {\n        // 点击集合地点\n        uni.showToast({\n          title: '集合地点',\n          icon: 'none'\n        })\n      } else if (markerId === 2) {\n        // 点击演员位置\n        uni.showToast({\n          title: this.actorInfo.nickname || '演员位置',\n          icon: 'none'\n        })\n      }\n    },\n\n    callActor() {\n      if (this.actorInfo.mobile) {\n        uni.makePhoneCall({\n          phoneNumber: this.actorInfo.mobile\n        })\n      } else {\n        uni.showToast({\n          title: '暂无联系方式',\n          icon: 'none'\n        })\n      }\n    },\n\n    messageActor() {\n      // TODO: 实现消息功能\n      uni.showToast({\n        title: '消息功能开发中',\n        icon: 'none'\n      })\n    },\n\n    goToDetail() {\n      uni.navigateTo({\n        url: `/pages/crew/order_detail?id=${this.orderId}`\n      })\n    },\n\n    async confirmArrival() {\n      uni.showModal({\n        title: '确认完成',\n        content: '确认演员已到达并完成工作？确认后订单将标记为已完成。',\n        success: async (res) => {\n          if (res.confirm) {\n            try {\n              uni.showLoading({ title: '处理中...', mask: true })\n              const orderCo = uniCloud.importObject('order-co')\n              const result = await orderCo.completeOrder(this.orderId)\n              uni.hideLoading()\n\n              if (result.code === 0) {\n                uni.showToast({\n                  title: '订单已完成',\n                  icon: 'success'\n                })\n                this.order.order_status = 3\n                setTimeout(() => {\n                  uni.navigateTo({\n                    url: `/pages/crew/order_detail?id=${this.orderId}`\n                  })\n                }, 1500)\n              } else {\n                uni.showToast({\n                  title: result.message || '操作失败',\n                  icon: 'none'\n                })\n              }\n            } catch (error) {\n              uni.hideLoading()\n              console.error('确认完成失败:', error)\n              uni.showToast({\n                title: '网络错误，请重试',\n                icon: 'none'\n              })\n            }\n          }\n        }\n      })\n    },\n\n    async completeOrder() {\n      try {\n        uni.showModal({\n          title: '确认完成',\n          content: '确认本次工作已完成？确认后将进入支付流程。',\n          success: async (res) => {\n            if (res.confirm) {\n              // TODO: 调用完成订单接口\n              uni.showToast({\n                title: '订单已完成',\n                icon: 'success'\n              })\n              setTimeout(() => {\n                uni.navigateTo({\n                  url: `/pages/crew/order_detail?id=${this.orderId}`\n                })\n              }, 1500)\n            }\n          }\n        })\n      } catch (error) {\n        console.error('完成订单失败:', error)\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import '@/common/theme.scss';\n\n.tracking-page {\n  width: 100%;\n  height: 100vh;\n  position: relative;\n  background-color: $bg-primary;\n}\n\n.tracking-map {\n  width: 100%;\n  height: 55vh;\n}\n\n// 状态覆盖层\n.status-overlay {\n  position: absolute;\n  top: 32rpx;\n  left: 32rpx;\n  right: 32rpx;\n}\n\n.status-card-cover {\n  background-color: rgba(30, 30, 30, 0.95);\n  border-radius: 16rpx;\n  padding: 24rpx 32rpx;\n}\n\n.status-title {\n  font-size: 32rpx;\n  font-weight: 700;\n  color: #FFD700;\n  display: block;\n}\n\n.status-distance {\n  font-size: 24rpx;\n  color: rgba(255, 255, 255, 0.7);\n  margin-top: 8rpx;\n  display: block;\n}\n\n// 底部信息面板\n.info-panel {\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: $bg-secondary;\n  border-radius: $border-radius-lg $border-radius-lg 0 0;\n  padding: $spacing-lg;\n  padding-bottom: calc(#{$spacing-lg} + env(safe-area-inset-bottom));\n  max-height: 50vh;\n  overflow-y: auto;\n}\n\n// 演员信息区域\n.actor-info-section {\n  display: flex;\n  align-items: center;\n  gap: $spacing-base;\n  padding-bottom: $spacing-base;\n  border-bottom: 1rpx solid rgba(255, 255, 255, 0.1);\n\n  .actor-avatar {\n    width: 100rpx;\n    height: 100rpx;\n    border-radius: 50%;\n    background-color: $gray-4;\n  }\n\n  .actor-detail {\n    flex: 1;\n    @include flex-column;\n    gap: 8rpx;\n\n    .actor-name {\n      font-size: $font-size-lg;\n      font-weight: $font-weight-bold;\n      color: $text-primary;\n    }\n\n    .actor-status {\n      display: flex;\n      align-items: center;\n      gap: 8rpx;\n\n      .online-dot {\n        width: 16rpx;\n        height: 16rpx;\n        border-radius: 50%;\n        background-color: $gray-3;\n\n        &.online {\n          background-color: $success-color;\n        }\n      }\n\n      .status-text {\n        font-size: $font-size-sm;\n        color: $text-secondary;\n      }\n    }\n  }\n\n  .action-buttons-small {\n    display: flex;\n    gap: $spacing-sm;\n\n    .action-btn {\n      width: 80rpx;\n      height: 80rpx;\n      @include flex-center;\n      background-color: $bg-tertiary;\n      border-radius: 50%;\n\n      &:active {\n        opacity: 0.8;\n      }\n    }\n  }\n}\n\n// 订单信息区域\n.order-info-section {\n  padding: $spacing-base 0;\n  border-bottom: 1rpx solid rgba(255, 255, 255, 0.1);\n\n  .info-item {\n    display: flex;\n    align-items: center;\n    gap: $spacing-sm;\n    margin-bottom: $spacing-xs;\n\n    &:last-child {\n      margin-bottom: 0;\n    }\n\n    .info-text {\n      font-size: $font-size-sm;\n      color: $text-secondary;\n    }\n  }\n}\n\n// 问题上报区域\n.issue-section {\n  padding: $spacing-base 0;\n  border-bottom: 1rpx solid rgba(255, 255, 255, 0.1);\n\n  .issue-header {\n    display: flex;\n    align-items: center;\n    gap: $spacing-xs;\n    margin-bottom: $spacing-sm;\n\n    .issue-title {\n      font-size: $font-size-sm;\n      font-weight: $font-weight-bold;\n      color: #FF6B6B;\n    }\n  }\n\n  .issue-list {\n    display: flex;\n    flex-direction: column;\n    gap: $spacing-xs;\n  }\n\n  .issue-item {\n    display: flex;\n    align-items: center;\n    gap: $spacing-sm;\n    padding: $spacing-xs $spacing-sm;\n    background-color: rgba(255, 107, 107, 0.1);\n    border-radius: $border-radius-sm;\n  }\n\n  .issue-type-tag {\n    padding: 4rpx 12rpx;\n    border-radius: 8rpx;\n    font-size: $font-size-xs;\n    font-weight: $font-weight-medium;\n    flex-shrink: 0;\n\n    &.late_warning {\n      background-color: rgba(255, 193, 7, 0.2);\n      color: #FFC107;\n    }\n\n    &.cannot_arrive {\n      background-color: rgba(244, 67, 54, 0.2);\n      color: #F44336;\n    }\n\n    &.safety_issue {\n      background-color: rgba(255, 87, 34, 0.2);\n      color: #FF5722;\n    }\n\n    &.other {\n      background-color: rgba(158, 158, 158, 0.2);\n      color: #9E9E9E;\n    }\n  }\n\n  .issue-desc {\n    flex: 1;\n    font-size: $font-size-xs;\n    color: $text-secondary;\n    @include text-ellipsis;\n  }\n\n  .issue-time {\n    font-size: $font-size-xs;\n    color: $text-hint;\n    flex-shrink: 0;\n  }\n}\n\n// 底部操作按钮\n.bottom-actions {\n  display: flex;\n  gap: $spacing-base;\n  margin-top: $spacing-base;\n  padding-top: $spacing-base;\n  border-top: 1rpx solid rgba(255, 255, 255, 0.1);\n\n  button {\n    flex: 1;\n    height: 88rpx;\n    line-height: 88rpx;\n    border-radius: $border-radius-base;\n    font-size: $font-size-base;\n    font-weight: $font-weight-bold;\n  }\n\n  .btn-primary {\n    @include button-primary;\n  }\n\n  .btn-secondary {\n    @include button-secondary;\n  }\n}\n</style>\n","import mod from \"-!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./order_tracking.vue?vue&type=style&index=0&id=1474fde6&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./order_tracking.vue?vue&type=style&index=0&id=1474fde6&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1768460232039\n      var cssReload = require(\"D:/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}