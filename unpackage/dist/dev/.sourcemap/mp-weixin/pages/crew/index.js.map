{"version":3,"sources":["uni-app:///main.js","webpack:///D:/SceneReady/SceneReady-main/pages/crew/index.vue?7cb5","webpack:///D:/SceneReady/SceneReady-main/pages/crew/index.vue?2aae","webpack:///D:/SceneReady/SceneReady-main/pages/crew/index.vue?4cde","webpack:///D:/SceneReady/SceneReady-main/pages/crew/index.vue?f6e3","uni-app:///pages/crew/index.vue","webpack:///D:/SceneReady/SceneReady-main/pages/crew/index.vue?e9a8","webpack:///D:/SceneReady/SceneReady-main/pages/crew/index.vue?61ba"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","isLoggedIn","mapCenter","latitude","longitude","mapScale","actorMarkers","drawerHeight","drawerMinHeight","drawerMaxHeight","touchStartY","drawerStartHeight","isDragging","searchKeyword","searchResults","searchLoading","searchTimer","actorList","actorMarkerData","selectedActor","actorsLoading","defaultAvatarPath","pushClientId","pushConnected","markerAnimationDuration","pushMessageHandler","miniProgramPollingTimer","mapContext","regionChangeDebounceTimer","regionChangeDebounceDelay","currentViewport","clusterMarkers","userLocation","userInfo","stats","pending","ongoing","completed","orderList","statusClassMap","computed","crewCreditLevelClass","crewCreditLevel","onLoad","onPullDownRefresh","setTimeout","uni","onShow","onHide","onUnload","clearTimeout","methods","refreshData","getMyLocation","type","isHighAccuracy","highAccuracyExpireTime","success","console","fail","title","icon","onRegionChange","loadActorsByViewport","southwest","northeast","onMarkerTap","loadActors","viewport","orderCo","params","userLongitude","userLatitude","includeOffline","maxDistance","res","skillLabelMap","bodyTypeMap","processedActors","actorLat","actorLng","full","id","_id","nickname","avatar","height","gender","bodyType","credit_score","distance","skills","videoCard","isOnline","lastActiveTime","marker","filter","updateActorMarkers","iconPath","width","anchor","x","y","joinCluster","callout","content","display","bgColor","color","fontSize","borderRadius","padding","onMarkerClusterCreate","textAlign","onMarkerClusterClick","duration","initPushAndSubscribe","getPushClientId","resolve","generateDeviceId","registerPushListener","startMiniProgramPolling","pushLocationCo","subscribeToServer","push_clientid","user_location","role","platform","updateSubscription","is_active","setSubscriptionInactive","unsubscribePush","clearInterval","handlePushMessage","getPlatform","handleLocationUpdate","updates","smoothMoveMarker","markerId","destination","autoRotate","handleActorOnline","actor_info","handleActorOffline","showActorDetail","closeActorDetail","inviteActor","onDrawerTouchStart","onDrawerTouchMove","newHeight","onDrawerTouchEnd","onSearchInput","searchActorsFromApi","keyword","limit","onSearchResultTap","points","clearSearch","checkLoginStatus","requireLogin","confirmText","url","loadUserInfo","uniCloud","loadStats","token","userCo","loadRecentOrders","page","pageSize","goToPostOrder","goToOrderList","goToOrderDetail","goToProfile","getCreditClass","getCreditLevel","getStatusText","formatTime"],"mappings":";;;;;;;;;;;;;AAAA;AAE2D;AAC3D;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,eAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA8H;AAC9H;AACyD;AACL;AACsC;;;AAG1F;AAC6L;AAC7L,gBAAgB,uMAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,4FAAM;AACR,EAAE,qGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,gGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,sTAEN;AACP,KAAK;AACL;AACA,aAAa,gQAEN;AACP,KAAK;AACL;AACA,aAAa,sNAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACjGA;AAAA;AAAA;AAAA;AAAouB,CAAgB,ivBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eC8NxvB;EACAC;IACA;MACA;MACAC;MAEA;MACAC;QACAC;QACAC;MACA;MACAC;MACAC;MAEA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MAEA;MACAC;MACAC;MACAC;MACAC;MAEA;MACAC;MAAA;MACAC;MAAA;MACAC;MACAC;MAEA;MACAC;MAAA;;MAEA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;;MAEA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;;MAEA;MACAC;MAAA;;MAEA;MACAC;QACA5B;QACAD;MACA;MAEA;MACA8B;MACAC;QACAC;QACAC;QACAC;MACA;MACAC;MACAC;QACA;QACA;QACA;QACA;QACA;MACA;IACA;EACA;EAEAC;IACAC;MACA;MACA;MACA;MACA;IACA;IACAC;MACA;MACA;IACA;EACA;EAEAC;IAAA;IAAA;MAAA;QAAA;UAAA;YAAA;cACA;cACA;cACA;cACA;cAEA;gBACA;gBACA;gBACA;cACA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EACA;EAEAC;IACA;IACA;IACA;MACA;MACA;IACA;IACAC;MACAC;IACA;EACA;EAEA;EACAC;IACA;EACA;EAEA;EACAC;IACA;EACA;EAEA;EACAC;IACA;IACA;IACA;MACAC;MACA;IACA;EACA;EAEAC;IACA;IACAC;MACA;MACA;MACA;QACA;QACA;QACA;MACA;IACA;IAEA;IACAC;MAAA;MACAP;QACAQ;QACAC;QACAC;QACAC;UACA;UACA;UACA;YACArD;YACAD;UACA;UACAuD;UACA;UACA;UACA;QACA;QACAC;UACAD;UACAZ;YACAc;YACAC;UACA;UACA;YACAzD;YACAD;UACA;UACA;UACA;UACA;QACA;MACA;IACA;IAEA;IACA2D;MAAA;MACA;QACA;QACA;UACAZ;QACA;QACA;QACA;UACA;QACA;MACA;IACA;IAEA;IACAa;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,IACA;kBAAA;kBAAA;gBAAA;gBACAL;gBAAA;cAAA;gBAIA;kBACA;kBACA;oBACAD;sBACA;wBACAO;wBACAC;sBACA;sBACAP;sBACA;sBACA;;sBAEA;sBACA;wBACA;sBACA;oBACA;oBACAC;sBACAD;sBACA;sBACA;oBACA;kBACA;gBACA;kBACAA;kBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAEAQ;MACA;MACA;QAAA;MAAA;MACA;QACA;MACA;IACA;IAEA;IACA;IACA;IACAC;MAAA;QAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAAC;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAAA,KAIA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBACA;gBAAA;gBAGAC;gBACAC;gBAEA;kBACA;kBACAA;oBACA;oBACAN;sBACA7D;sBACAC;oBACA;oBACA6D;sBACA9D;sBACAC;oBACA;oBACA;oBACAmE;oBACAC;oBACAC;kBACA;kBACAf;gBACA;kBACA;kBACAY;oBACAlE;oBACAD;oBACAuE;oBAAA;oBACAD;kBACA;kBACAf;gBACA;gBAAA;gBAAA,OAEAW;cAAA;gBAAAM;gBAEA;kBACA1D;kBAEA2D;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;kBACA;kBAEAC;oBACA;oBACA;oBACA;oBACA;kBACA,GAEA;kBACAC;oBACA;oBACA;oBACA;;oBAEA;oBACA;oBACA;oBACA;oBAEA;sBACAC;sBACAC;oBACA;sBACAD;sBACAC;oBACA;sBACAD;sBACAC;oBACA;oBAEA;oBAEA;sBACA;sBACAC;wBACAC;wBACAC;wBACAC;wBACAC;wBACAC;wBACAC;wBACAC;wBACAC;wBACAC;wBACAC;0BAAA;wBAAA;wBACAxF;wBACAC;wBACAwF;wBACAC;wBACAC;sBACA;sBACA;sBACAC;wBACAb;wBACA/E;wBACAC;wBACAiF;wBACAQ;wBACAT;wBACAE;sBACA;oBACA;kBACA;kBACA;kBAAA,CACAU;oBAAA;kBAAA,IAEA;kBACA;oBAAA;kBAAA;kBACA;oBAAA;kBAAA;kBAEAtC;;kBAEA;kBACA;gBACA;kBACA;kBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAA;gBACA;gBACA;gBACA;cAAA;gBAAA;gBAEA;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACAuC;MAAA;MACA;MACA;QACA;QACA;QACA;QAEA;UACAf;UACA/E;UACAC;UACA8F;UACAC;UACAb;UACAc;YAAAC;YAAAC;UAAA;UACA;UACAC;UACAC;YACAC;YACAC;YACAC;YACAC;YACAC;YACAC;YACAC;UACA;QACA;MACA;IACA;IAEA;IACAC;MACA;MACA;MACA;MACAtD;;MAEA;MACA;QACA;QACA;UACAwB;UACA/E;UACAC;UACA+F;UACAb;UACAkB;YACAC;YACAC;YACAC;YACAC;YACAC;YACAC;YACAC;YACAE;UACA;QACA;MACA;IACA;IAEA;IACAC;MACA;MACA;MACAxD;MAEA;QACA;QACA;QACA;QACA;UACAvD;UACAC;QACA;;QAEA;QACA0C;UACAc;UACAC;UACAsD;QACA;MACA;IACA;IAEA;IAEA;IACAC;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,MAEA;kBAAA;kBAAA;gBAAA;gBACA1D;gBAAA;cAAA;gBAAA;gBAAA;gBAAA,OAMA;cAAA;gBAEA;gBACA;;gBAEA;gBAAA;gBAAA,OACA;cAAA;gBAEAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACA2D;MAAA;MACA;QA6BA;QACA;QACA;QACA;QACA;QACA;QACA3D;QACA4D;MAUA;IACA;IAEA;IACAC;MACA;MACAzE;MACA;IACA;IAEA;IACA0E;MA8BA;MACA;MACA;IAEA;IAEA;IACAC;MAAA;MACA;MACA;MACA;MACA;MACA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,IACA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBACA;kBACA;kBACAC,yDACA;kBACA;kBACA;kBACA;kBACA;gBACA;kBACAhE;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,CACA;IACA;IAEA;IACAiE;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,IACA;kBAAA;kBAAA;gBAAA;gBACAjE;gBAAA;cAAA;gBAAA;gBAKAgE;gBAAA;gBAAA,OACAA;kBACAE;kBACAxD;kBACAyD;kBACAC;kBACAC;gBACA;cAAA;gBANApD;gBAQA;kBACAjB;gBACA;kBACAA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACAsE;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,MACA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAGAN;gBAAA;gBAAA,OACAA;kBACAO;kBACA7D;kBACAyD;gBACA;cAAA;gBACAnE;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACAwE;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,IACA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAGAR;gBAAA;gBAAA,OACAA;kBACAO;gBACA;cAAA;gBACAvE;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACAyE;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAUA;gBACA;kBACAC;kBACA;gBACA;;gBAGA;gBAAA,KACA;kBAAA;kBAAA;gBAAA;gBAAA;gBAEAV;gBAAA;gBAAA,OACAA;cAAA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAhE;cAAA;gBAIA;gBACAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;IAEA;IACA2E;MACA3E;MAEA;QACAA;QACA;MACA;MAEA;QACA;UACA;UACA;UACA;QAEA;UACA;UACA;UACA;QAEA;UACA;UACA;UACA;QAEA;UACAA;MAAA;IAEA;IAEA;IACA4E;MAKA;MAKA;IACA;IAEA;IACAC;MAAA;MACA;MACA;;MAEA;MAEAC;QACA;UAAArI;UAAAC;QAEA;UACA;QACA;;QAEA;QACA;UAAA;QAAA;QACA;UACA;UACA;;UAEA;UACA;UACA;;UAEA;UACA;QACA;;QAEA;QACA;UAAA;QAAA;QACA;UACA;UACA;QACA;;QAEA;QACA;UAAA;QAAA;QACA;UACA;UACA;QACA;MACA;MAEAsD;IACA;IAEA;IACA+E;MAAA;MACA;QACA/E;QACA;MACA;;MAEA;MACA;MACA;MACA;QACA;MACA;;MAEA;MACA;QACAgF;QACAC;UACAxI;UACAC;QACA;QACA+G;QACAyB;QACAnF;UACA;QAAA,CACA;QACAE;UACA;UACAD;UACA;QACA;MACA;IACA;IAEA;IACAmF;MACA;QAAA1I;QAAAC;QAAA0I;;MAEA;MACA;QAAA;MAAA;MAEA;QACA;QACA;QACA;QACA;MACA;QACA;QACA;UACA5D;UACA/E;UACAC;UACAiF;UACAQ;UACAT;UACAE;QACA;MACA;;MAEA;MACA;MACA5B;IACA;IAEA;IACAqF;MACA;;MAEA;MACA;QAAA;MAAA;MACA;QACA;MACA;MAEA;QAAA;MAAA;MACA;QACA;MACA;;MAEA;MACA;MACArF;IACA;IAEAsF;MACA;MACA;IACA;IAEAC;MACA;IACA;IAEAC;MACA;MACApG;QACAc;QACAC;MACA;IACA;IAEA;IACAsF;MACA;MACA;MACA;IACA;IAEAC;MACA;MAEA;MACA;MACA;MAEA;MAEA;QACAC;MACA;MACA;QACAA;MACA;MAEA;IACA;IAEAC;MACA;MACA;MACA;IACA;IAEA;IACAC;MAAA;MACA;MACA;QACArG;MACA;MAEA;MACA;QACA;QACA;QACA;MACA;;MAEA;MACA;;MAEA;MACA;QACA;MACA;IACA;IAEA;IACAsG;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,IACAC;kBAAA;kBAAA;gBAAA;gBACA;gBACA;gBAAA;cAAA;gBAAA;gBAKApF,6CAEA;gBACAC;kBACAmF;kBACA;kBACAlF;kBACAC;kBACA;kBACAkF;gBACA;gBAEAhG;gBAAA;gBAAA,OAEAW;cAAA;gBAAAM;gBAEA;kBACA;kBACAC;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;oBACA;kBACA;kBAEAC;oBACA;oBACA;oBACA;oBACA;kBACA;kBAEA;oBACA;oBACA;;oBAEA;oBACA;oBACA;oBACA;oBAEA;sBACAE;sBACAC;oBACA;sBACAD;sBACAC;oBACA;sBACAD;sBACAC;oBACA;oBAEA;sBACAE;sBACAC;sBACAC;sBACAC;sBACAC;sBACAC;sBACAC;sBACAC;sBACAC;sBACAC;wBAAA;sBAAA;sBACAxF;sBACAC;sBACAwF;sBACAC;sBACAC;oBACA;kBACA;kBAEApC;gBACA;kBACA;kBACA;oBACAA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAA;gBACA;gBACAZ;kBACAc;kBACAC;gBACA;cAAA;gBAAA;gBAEA;gBAAA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA;IACA8F;MAAA;MACA;;MAEA;MACA;;MAEA;MACA;QACA;QACA;;QAEA;QACA;QACA;QAEAjG;;QAEA;QACA;UACA;YACAkG;cACAzJ;cACAC;YACA;YACA2G;YACAtD;cACAC;YACA;YACAC;cACAD;YACA;UACA;QACA;MACA;;MAEA;MACA;MACAb;QACA;MACA;IACA;IAEAgH;MACA;MACA;MACA;IACA;IAEA;IACAC;MACA;QACA;QACA;QACA;MACA;QACA;MACA;IACA;IAEAC;MAAA;MACA;MAEAjH;QACAc;QACA6C;QACAuD;QACAvG;UACA;YACAX;YACAA;cACAmH;YACA;UACA;QACA;MACA;MACA;IACA;IAEAC;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA;gBAAA,OAEAC;cAAA;gBAAAxF;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAjB;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA0G;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEAC;gBAAA,IACAA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAEAC;gBAAA;gBAAA,OACAA;cAAA;gBAAA3F;gBAEA;kBACA;oBACAxC;oBACAC;oBACAC;kBACA;kBACA;oBACA;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAqB;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEA6G;MAAA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAEAF;gBAAA,IACAA;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAEAhG;gBAAA;gBAAA,OACAA;kBACAmG;kBACAC;gBACA;cAAA;gBAHA9F;gBAKA;kBACA;gBACA;kBACA7B;oBACAmH;kBACA;gBACA;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;gBAEAvG;gBACA;kBACAZ;oBACAmH;kBACA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAEA;IAEAS;MACA;MACA5H;QACAmH;MACA;IACA;IAEAU;MACA;MACA7H;QACAmH;MACA;IACA;IAEAW;MACA;MACA9H;QACAmH;MACA;IACA;IAEAY;MACA;MACA/H;QACAmH;MACA;IACA;IAEA;IACAa;MACA;MACA;MACA;IACA;IAEAC;MACA;MACA;MACA;MACA;IACA;IAEAC;MACA;QACA;QACA;QACA;QACA;QACA;MACA;MACA;IACA;IAEAC;MACA;MACA;MACA;MAEA;MACA;MACA;MACA;MAEA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;AC38CA;AAAA;AAAA;AAAA;AAA+4C,CAAgB,g2CAAG,EAAC,C;;;;;;;;;;;ACAn6C;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/crew/index.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './pages/crew/index.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=0e9da1dd&scoped=true&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=0e9da1dd&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0e9da1dd\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/crew/index.vue\"\nexport default component.exports","export * from \"-!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=0e9da1dd&scoped=true&\"","var components\ntry {\n  components = {\n    uniIcons: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-icons/components/uni-icons/uni-icons\" */ \"@/uni_modules/uni-icons/components/uni-icons/uni-icons.vue\"\n      )\n    },\n    uniPopup: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-popup/components/uni-popup/uni-popup\" */ \"@/uni_modules/uni-popup/components/uni-popup/uni-popup.vue\"\n      )\n    },\n    customTabbar: function () {\n      return import(\n        /* webpackChunkName: \"components/custom-tabbar/custom-tabbar\" */ \"@/components/custom-tabbar/custom-tabbar.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 =\n    _vm.searchKeyword && !_vm.searchLoading && _vm.searchResults.length > 0\n  var g1 = g0 ? _vm.searchResults.length : null\n  var l0 = g0\n    ? _vm.__map(_vm.searchResults, function (actor, __i0__) {\n        var $orig = _vm.__get_orig(actor)\n        var m0 = _vm.getCreditClass(actor.credit_score)\n        return {\n          $orig: $orig,\n          m0: m0,\n        }\n      })\n    : null\n  var g2 = !(_vm.searchKeyword && _vm.searchLoading)\n    ? _vm.searchKeyword && _vm.searchResults.length === 0 && !_vm.searchLoading\n    : null\n  var g3 = !_vm.searchKeyword ? _vm.orderList.length : null\n  var l1 =\n    !_vm.searchKeyword && g3 > 0\n      ? _vm.__map(_vm.orderList.slice(0, 3), function (order, __i1__) {\n          var $orig = _vm.__get_orig(order)\n          var m1 = _vm.getStatusText(order.order_status)\n          var m2 = _vm.formatTime(order.create_time)\n          var g4 = (order.price_amount / 100).toFixed(0)\n          return {\n            $orig: $orig,\n            m1: m1,\n            m2: m2,\n            g4: g4,\n          }\n        })\n      : null\n  if (!_vm._isMounted) {\n    _vm.e0 = function ($event, order) {\n      var _temp = arguments[arguments.length - 1].currentTarget.dataset,\n        _temp2 = _temp.eventParams || _temp[\"event-params\"],\n        order = _temp2.order\n      var _temp, _temp2\n      return _vm.goToOrderDetail(order._id)\n    }\n  }\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        g1: g1,\n        l0: l0,\n        g2: g2,\n        g3: g3,\n        l1: l1,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","<template>\n  <view class=\"crew-home-map\">\n    <!-- 地图层 -->\n    <map\n      id=\"crewMap\"\n      class=\"map-layer\"\n      :latitude=\"mapCenter.latitude\"\n      :longitude=\"mapCenter.longitude\"\n      :scale=\"mapScale\"\n      :markers=\"actorMarkers\"\n      :show-location=\"true\"\n      :enable-3D=\"false\"\n      :enable-overlooking=\"false\"\n      @markertap=\"onMarkerTap\"\n      @regionchange=\"onRegionChange\"\n      @markerClusterCreate=\"onMarkerClusterCreate\"\n      @markerClusterClick=\"onMarkerClusterClick\"\n    >\n    </map>\n\n    <!-- 底部抽屉 -->\n    <view\n      class=\"drawer-container\"\n      :style=\"{ height: drawerHeight + 'rpx' }\"\n      @touchstart=\"onDrawerTouchStart\"\n      @touchmove.stop.prevent=\"onDrawerTouchMove\"\n      @touchend=\"onDrawerTouchEnd\"\n    >\n      <!-- 抽屉把手 -->\n      <view class=\"drawer-handle-area\">\n        <view class=\"drawer-handle\"></view>\n      </view>\n\n      <!-- 抽屉内容 -->\n      <scroll-view\n        scroll-y\n        class=\"drawer-content\"\n        :style=\"{ height: (drawerHeight - 60) + 'rpx' }\"\n      >\n        <!-- 搜索栏 -->\n        <view class=\"search-bar\">\n          <uni-icons type=\"search\" size=\"20\" color=\"#999\"></uni-icons>\n          <input\n            class=\"search-input\"\n            placeholder=\"搜索演员\"\n            placeholder-class=\"search-placeholder\"\n            v-model=\"searchKeyword\"\n            @input=\"onSearchInput\"\n          />\n          <view v-if=\"searchKeyword\" class=\"search-clear\" @tap=\"clearSearch\">\n            <uni-icons type=\"close\" size=\"16\" color=\"#999\"></uni-icons>\n          </view>\n        </view>\n\n        <!-- 搜索结果列表 -->\n        <view v-if=\"searchKeyword && !searchLoading && searchResults.length > 0\" class=\"search-results\">\n          <view class=\"section-header-compact\">\n            <text class=\"section-title-text\">搜索结果</text>\n            <text class=\"result-count\">{{ searchResults.length }}人</text>\n          </view>\n          <view class=\"search-list\">\n            <view\n              v-for=\"actor in searchResults\"\n              :key=\"actor.id\"\n              class=\"search-item\"\n              @tap=\"onSearchResultTap(actor)\"\n            >\n              <image class=\"actor-avatar\" :src=\"actor.avatar || '/static/default-avatar.png'\" mode=\"aspectFill\"></image>\n              <view class=\"actor-info\">\n                <view class=\"actor-name\">{{ actor.nickname }}</view>\n                <view class=\"actor-meta\">\n                  <text class=\"meta-item\">{{ actor.height }}cm</text>\n                  <text class=\"meta-divider\">|</text>\n                  <text class=\"meta-item\">{{ actor.distance }}km</text>\n                </view>\n              </view>\n              <view :class=\"['credit-badge', getCreditClass(actor.credit_score)]\">\n                {{ actor.credit_score }}\n              </view>\n            </view>\n          </view>\n        </view>\n\n        <!-- 搜索Loading状态 -->\n        <view v-if=\"searchKeyword && searchLoading\" class=\"search-loading\">\n          <view class=\"loading-spinner\"></view>\n          <text class=\"loading-text\">搜索中...</text>\n        </view>\n\n        <!-- 搜索无结果 -->\n        <view v-else-if=\"searchKeyword && searchResults.length === 0 && !searchLoading\" class=\"empty-search\">\n          <text class=\"empty-text\">未找到匹配的演员</text>\n        </view>\n\n        <!-- 非搜索状态：显示最近订单和信用分 -->\n        <view v-if=\"!searchKeyword\" class=\"main-content\">\n          <!-- 最近订单 -->\n          <view class=\"recent-orders-compact\">\n            <view class=\"section-header-compact\">\n              <text class=\"section-title-text\">最近订单</text>\n              <view class=\"more-link\" @tap=\"goToOrderList\">\n                <text>全部</text>\n                <uni-icons type=\"forward\" size=\"14\" color=\"#FFD700\"></uni-icons>\n              </view>\n            </view>\n\n            <view v-if=\"orderList.length > 0\" class=\"order-list-compact\">\n              <view\n                v-for=\"order in orderList.slice(0, 3)\"\n                :key=\"order._id\"\n                class=\"order-item-compact\"\n                @tap=\"goToOrderDetail(order._id)\"\n              >\n                <view class=\"order-header-compact\">\n                  <text :class=\"['order-status-compact', statusClassMap[order.order_status]]\">\n                    {{ getStatusText(order.order_status) }}\n                  </text>\n                  <text class=\"order-time-compact\">{{ formatTime(order.create_time) }}</text>\n                </view>\n                <view class=\"order-content-compact\">\n                  <text class=\"order-location\">{{ order.meeting_location_name }}</text>\n                  <text class=\"order-price\">{{ (order.price_amount / 100).toFixed(0) }}</text>\n                </view>\n              </view>\n            </view>\n            <view v-else class=\"empty-orders-compact\">\n              <text class=\"empty-text-compact\">暂无订单</text>\n            </view>\n          </view>\n\n          <!-- 信用分 -->\n          <view class=\"credit-section-compact\">\n            <view class=\"credit-info\">\n              <text class=\"credit-title-compact\">信用分</text>\n              <view class=\"credit-score-compact\">\n                <text class=\"score-value\">{{ userInfo.credit_score_crew || 100 }}</text>\n                <text class=\"score-max\">/150</text>\n              </view>\n            </view>\n            <view :class=\"['credit-level-badge', crewCreditLevelClass]\">\n              {{ crewCreditLevel }}\n            </view>\n          </view>\n        </view>\n      </scroll-view>\n    </view>\n\n    <!-- FAB 悬浮按钮 -->\n    <cover-view class=\"fab\" @tap=\"goToPostOrder\">\n      <cover-view class=\"fab-bg\"></cover-view>\n      <cover-view class=\"fab-icon\">+</cover-view>\n    </cover-view>\n\n    <!-- 演员详情弹窗 -->\n    <uni-popup ref=\"actorDetailPopup\" type=\"bottom\" :safe-area=\"true\">\n      <view class=\"actor-detail-popup\">\n        <view class=\"popup-header\">\n          <text class=\"popup-title\">演员资料</text>\n          <view class=\"popup-close\" @tap=\"closeActorDetail\">\n            <uni-icons type=\"close\" size=\"24\" color=\"#fff\"></uni-icons>\n          </view>\n        </view>\n\n        <view v-if=\"selectedActor\" class=\"actor-detail-content\">\n          <!-- 视频模卡预览区 -->\n          <view class=\"video-card-preview\">\n            <video\n              v-if=\"selectedActor.videoCard\"\n              :src=\"selectedActor.videoCard\"\n              :controls=\"true\"\n              :autoplay=\"false\"\n              :muted=\"true\"\n              class=\"video-player\"\n            ></video>\n            <view v-else class=\"video-placeholder\">\n              <uni-icons type=\"videocam\" size=\"48\" color=\"#666\"></uni-icons>\n              <text class=\"placeholder-text\">暂无视频模卡</text>\n            </view>\n          </view>\n\n          <!-- 详细信息 -->\n          <view class=\"detail-info-grid\">\n            <view class=\"info-item\">\n              <text class=\"info-label\">姓名</text>\n              <text class=\"info-value\">{{ selectedActor.nickname }}</text>\n            </view>\n            <view class=\"info-item\">\n              <text class=\"info-label\">性别</text>\n              <text class=\"info-value\">{{ selectedActor.gender === 1 ? '男' : '女' }}</text>\n            </view>\n            <view class=\"info-item\">\n              <text class=\"info-label\">身高</text>\n              <text class=\"info-value\">{{ selectedActor.height }}cm</text>\n            </view>\n            <view class=\"info-item\">\n              <text class=\"info-label\">体型</text>\n              <text class=\"info-value\">{{ selectedActor.bodyType }}</text>\n            </view>\n          </view>\n\n          <view class=\"detail-skills\">\n            <text class=\"skills-label\">特长技能</text>\n            <view class=\"skills-list\">\n              <text v-for=\"skill in selectedActor.skills\" :key=\"skill\" class=\"skill-tag-large\">\n                {{ skill }}\n              </text>\n            </view>\n          </view>\n\n          <button class=\"btn-invite\" type=\"primary\" @tap=\"inviteActor\">\n            邀请TA接单\n          </button>\n        </view>\n      </view>\n    </uni-popup>\n\n    <!-- 底部 TabBar -->\n    <custom-tabbar role=\"crew\" :current=\"0\" @refresh=\"refreshData\"></custom-tabbar>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      // 登录状态\n      isLoggedIn: false,\n\n      // 地图相关\n      mapCenter: {\n        latitude: 29.5630,\n        longitude: 106.4650\n      },\n      mapScale: 15,\n      actorMarkers: [],\n\n      // 抽屉相关\n      drawerHeight: 400,\n      drawerMinHeight: 280,\n      drawerMaxHeight: 1000,\n      touchStartY: 0,\n      drawerStartHeight: 0,\n      isDragging: false,\n\n      // 搜索\n      searchKeyword: '',\n      searchResults: [],\n      searchLoading: false,\n      searchTimer: null,\n\n      // 演员数据（用于地图标记和搜索）\n      actorList: [],              // 完整列表数据（用于搜索和详情展示）\n      actorMarkerData: [],        // 轻量化地图标记数据（只含经纬度、ID、头像）\n      selectedActor: null,\n      actorsLoading: false,\n\n      // 演员地图显示相关\n      defaultAvatarPath: '/static/default-avatar.png', // 默认头像\n\n      // Uni-Push 2.0 实时位置更新相关\n      pushClientId: null,              // 推送客户端ID\n      pushConnected: false,            // 推送连接状态\n      markerAnimationDuration: 500,    // Marker移动动画时长（毫秒）\n      pushMessageHandler: null,        // 推送消息处理函数引用\n      miniProgramPollingTimer: null,   // 小程序降级轮询定时器\n\n      // 地图视口区域查询相关\n      mapContext: null,                // 地图上下文\n      regionChangeDebounceTimer: null, // 防抖定时器\n      regionChangeDebounceDelay: 500,  // 防抖延迟（毫秒）\n      currentViewport: null,           // 当前视口边界\n\n      // 点聚合相关\n      clusterMarkers: [],              // 聚合点标记\n\n      // 用户位置\n      userLocation: {\n        longitude: null,\n        latitude: null\n      },\n\n      // 用户信息\n      userInfo: {},\n      stats: {\n        pending: 0,\n        ongoing: 0,\n        completed: 0\n      },\n      orderList: [],\n      statusClassMap: {\n        0: 'status-pending',\n        1: 'status-ongoing',\n        2: 'status-payment',\n        3: 'status-completed',\n        4: 'status-canceled'\n      }\n    }\n  },\n\n  computed: {\n    crewCreditLevelClass() {\n      const score = this.userInfo.credit_score_crew || 100\n      if (score >= 130) return 'level-gold'\n      if (score >= 110) return 'level-silver'\n      return 'level-normal'\n    },\n    crewCreditLevel() {\n      const score = this.userInfo.credit_score_crew || 100\n      return this.getCreditLevel(score)\n    }\n  },\n\n  async onLoad() {\n    this.isLoggedIn = this.checkLoginStatus()\n    // 初始化地图上下文\n    this.mapContext = uni.createMapContext('crewMap', this)\n    this.getMyLocation()\n\n    if (this.isLoggedIn) {\n      this.loadUserInfo()\n      this.loadStats()\n      this.loadRecentOrders()\n    }\n  },\n\n  onPullDownRefresh() {\n    this.isLoggedIn = this.checkLoginStatus()\n    this.loadActors()\n    if (this.isLoggedIn) {\n      this.loadStats()\n      this.loadRecentOrders()\n    }\n    setTimeout(() => {\n      uni.stopPullDownRefresh()\n    }, 1000)\n  },\n\n  // 页面显示时订阅推送\n  onShow() {\n    this.initPushAndSubscribe()\n  },\n\n  // 页面隐藏时标记为非活跃\n  onHide() {\n    this.setSubscriptionInactive()\n  },\n\n  // 页面卸载时清理资源\n  onUnload() {\n    this.unsubscribePush()\n    // 清理防抖定时器\n    if (this.regionChangeDebounceTimer) {\n      clearTimeout(this.regionChangeDebounceTimer)\n      this.regionChangeDebounceTimer = null\n    }\n  },\n\n  methods: {\n    // ========== 刷新数据 ==========\n    refreshData() {\n      this.isLoggedIn = this.checkLoginStatus()\n      this.loadActors()\n      if (this.isLoggedIn) {\n        this.loadUserInfo()\n        this.loadStats()\n        this.loadRecentOrders()\n      }\n    },\n\n    // ========== 地图相关 ==========\n    getMyLocation() {\n      uni.getLocation({\n        type: 'gcj02',\n        isHighAccuracy: true,\n        highAccuracyExpireTime: 4000,\n        success: (res) => {\n          this.mapCenter.latitude = res.latitude\n          this.mapCenter.longitude = res.longitude\n          this.userLocation = {\n            longitude: res.longitude,\n            latitude: res.latitude\n          }\n          console.log('定位成功, 精度:', res.accuracy, '米')\n          this.loadActors()\n          // 获取到位置后初始化推送\n          this.initPushAndSubscribe()\n        },\n        fail: (err) => {\n          console.error('获取位置失败:', err)\n          uni.showToast({\n            title: '定位失败，使用默认位置',\n            icon: 'none'\n          })\n          this.userLocation = {\n            longitude: this.mapCenter.longitude,\n            latitude: this.mapCenter.latitude\n          }\n          this.loadActors()\n          // 即使使用默认位置也初始化推送\n          this.initPushAndSubscribe()\n        }\n      })\n    },\n\n    // 地图视口变化（带防抖）\n    onRegionChange(e) {\n      if (e.type === 'end') {\n        // 清除之前的防抖定时器\n        if (this.regionChangeDebounceTimer) {\n          clearTimeout(this.regionChangeDebounceTimer)\n        }\n        // 设置新的防抖定时器\n        this.regionChangeDebounceTimer = setTimeout(() => {\n          this.loadActorsByViewport()\n        }, this.regionChangeDebounceDelay)\n      }\n    },\n\n    // 按视口区域加载演员\n    async loadActorsByViewport() {\n      if (!this.mapContext) {\n        console.warn('mapContext not initialized')\n        return\n      }\n\n      try {\n        // 获取当前地图视口的西南角和东北角坐标\n        this.mapContext.getRegion({\n          success: (res) => {\n            this.currentViewport = {\n              southwest: res.southwest,\n              northeast: res.northeast\n            }\n            console.log('当前视口范围:', this.currentViewport)\n            // 使用视口边界加载演员\n            this.loadActors(this.currentViewport)\n\n            // 视口变化时，更新推送订阅范围\n            if (this.pushConnected) {\n              this.updateSubscription()\n            }\n          },\n          fail: (err) => {\n            console.error('获取地图视口失败:', err)\n            // 降级为使用中心点+半径方式\n            this.loadActors(null)\n          }\n        })\n      } catch (error) {\n        console.error('loadActorsByViewport error:', error)\n        this.loadActors(null)\n      }\n    },\n\n    onMarkerTap(e) {\n      const markerId = e.detail.markerId\n      const actor = this.actorList.find(a => a.id === markerId)\n      if (actor) {\n        this.showActorDetail(actor)\n      }\n    },\n\n    // 加载演员（用于地图标记和搜索）\n    // 显示所有已注册登录的演员：离线显示最后登录位置，在线显示实时位置\n    // viewport: { southwest: {latitude, longitude}, northeast: {latitude, longitude} }\n    async loadActors(viewport = null) {\n      if (!this.userLocation.longitude || !this.userLocation.latitude) {\n        return\n      }\n\n      if (this.actorsLoading) return\n      this.actorsLoading = true\n\n      try {\n        const orderCo = uniCloud.importObject('order-co')\n        let params = {}\n\n        if (viewport && viewport.southwest && viewport.northeast) {\n          // 按视口边界查询（推荐方式）\n          params = {\n            // 视口边界坐标\n            southwest: {\n              latitude: viewport.southwest.latitude,\n              longitude: viewport.southwest.longitude\n            },\n            northeast: {\n              latitude: viewport.northeast.latitude,\n              longitude: viewport.northeast.longitude\n            },\n            // 仍然传递用户位置用于计算距离\n            userLongitude: this.userLocation.longitude,\n            userLatitude: this.userLocation.latitude,\n            includeOffline: true\n          }\n          console.log('按视口边界查询演员:', params)\n        } else {\n          // 降级：按中心点+半径查询\n          params = {\n            longitude: this.userLocation.longitude,\n            latitude: this.userLocation.latitude,\n            maxDistance: 10000, // 10km\n            includeOffline: true\n          }\n          console.log('按中心点半径查询演员:', params)\n        }\n\n        const res = await orderCo.getNearbyActors(params)\n\n        if (res.code === 0 && res.data) {\n          const actorList = res.data.list || res.data // 兼容两种返回格式\n\n          const skillLabelMap = {\n            'driving': '开车',\n            'dancing': '跳舞',\n            'singing': '唱歌',\n            'martial_arts': '武术',\n            'swimming': '游泳',\n            'riding': '骑马',\n            'instrument': '乐器',\n            'language': '外语'\n          }\n\n          const bodyTypeMap = {\n            'slim': '偏瘦',\n            'standard': '标准',\n            'athletic': '健壮',\n            'plump': '偏胖'\n          }\n\n          // 处理演员数据，分离为轻量化标记数据和完整列表数据\n          const processedActors = actorList.map((actor, index) => {\n            // 处理头像：avatar_file.url > avatar > 默认头像\n            const avatarFile = actor.avatar_file\n            const avatarUrl = (avatarFile && avatarFile.url) || actor.avatar || this.defaultAvatarPath\n\n            // 确定演员位置\n            const isOnline = actor.online_status === 1\n            let actorLat = null\n            let actorLng = null\n\n            if (isOnline && actor.current_location) {\n              actorLat = actor.current_location.coordinates[1]\n              actorLng = actor.current_location.coordinates[0]\n            } else if (actor.last_login_location) {\n              actorLat = actor.last_login_location.coordinates[1]\n              actorLng = actor.last_login_location.coordinates[0]\n            } else if (actor.location) {\n              actorLat = actor.location.coordinates[1]\n              actorLng = actor.location.coordinates[0]\n            }\n\n            const actorId = actor._id || index + 1\n\n            return {\n              // 完整列表数据\n              full: {\n                id: actorId,\n                _id: actor._id,\n                nickname: actor.nickname || '--',\n                avatar: avatarUrl,\n                height: actor.height || 170,\n                gender: actor.gender || 0,\n                bodyType: bodyTypeMap[actor.body_type] || actor.body_type || '--',\n                credit_score: actor.credit_score_actor || 100,\n                distance: actor.distance_km ? parseFloat(actor.distance_km).toFixed(1) : '-',\n                skills: (actor.skills || []).map(s => skillLabelMap[s] || s),\n                latitude: actorLat,\n                longitude: actorLng,\n                videoCard: actor.video_card || actor.video_card_url || '',\n                isOnline: isOnline,\n                lastActiveTime: actor.last_active_time || null\n              },\n              // 轻量化地图标记数据（只含必要字段）\n              marker: {\n                id: actorId,\n                latitude: actorLat,\n                longitude: actorLng,\n                avatar: avatarUrl,\n                isOnline: isOnline,\n                nickname: actor.nickname || '--',\n                height: actor.height || 170\n              }\n            }\n          })\n          // 过滤掉没有有效坐标的演员\n          .filter(item => item.marker.latitude !== null && item.marker.longitude !== null)\n\n          // 分离数据\n          this.actorList = processedActors.map(item => item.full)\n          this.actorMarkerData = processedActors.map(item => item.marker)\n\n          console.log('演员数据加载完成, 列表数据:', this.actorList.length, '条, 标记数据:', this.actorMarkerData.length, '条')\n\n          // 生成地图标记\n          this.updateActorMarkers()\n        } else {\n          this.actorList = []\n          this.actorMarkerData = []\n          this.actorMarkers = []\n        }\n      } catch (error) {\n        console.error('加载演员失败:', error)\n        this.actorList = []\n        this.actorMarkerData = []\n        this.actorMarkers = []\n      } finally {\n        this.actorsLoading = false\n      }\n    },\n\n    // 更新地图标记（使用轻量化数据，支持点聚合）\n    updateActorMarkers() {\n      // 使用轻量化的标记数据生成markers\n      this.actorMarkers = this.actorMarkerData.map(marker => {\n        const isOnline = marker.isOnline\n        const statusText = isOnline ? '[在线]' : '[离线]'\n        const calloutColor = isOnline ? '#4CAF50' : '#999999'\n\n        return {\n          id: marker.id,\n          latitude: marker.latitude,\n          longitude: marker.longitude,\n          iconPath: marker.avatar || this.defaultAvatarPath,\n          width: 40,\n          height: 40,\n          anchor: { x: 0.5, y: 0.5 },\n          // 启用点聚合\n          joinCluster: true,\n          callout: {\n            content: statusText + ' ' + marker.nickname + ' ' + marker.height + 'cm',\n            display: 'BYCLICK',\n            bgColor: '#1E1E1E',\n            color: calloutColor,\n            fontSize: 12,\n            borderRadius: 8,\n            padding: 6\n          }\n        }\n      })\n    },\n\n    // 点聚合创建事件 - 当标记被聚合时触发\n    onMarkerClusterCreate(e) {\n      // e.detail.clusters 包含聚合点信息\n      // 每个cluster: { clusterId, center: {latitude, longitude}, markerIds: [] }\n      const clusters = e.detail.clusters || []\n      console.log('点聚合创建:', clusters.length, '个聚合点')\n\n      // 生成聚合点的自定义标记\n      this.clusterMarkers = clusters.map(cluster => {\n        const count = cluster.markerIds ? cluster.markerIds.length : 0\n        return {\n          id: cluster.clusterId,\n          latitude: cluster.center.latitude,\n          longitude: cluster.center.longitude,\n          width: 50,\n          height: 50,\n          callout: {\n            content: count + '位演员',\n            display: 'ALWAYS',\n            bgColor: '#FFD700',\n            color: '#000000',\n            fontSize: 12,\n            borderRadius: 25,\n            padding: 8,\n            textAlign: 'center'\n          }\n        }\n      })\n    },\n\n    // 点聚合点击事件 - 当用户点击聚合点时触发\n    onMarkerClusterClick(e) {\n      // e.detail.cluster 包含被点击的聚合点信息\n      const cluster = e.detail.cluster || e.detail\n      console.log('点击聚合点:', cluster)\n\n      if (cluster && cluster.center) {\n        // 放大地图以展开聚合点\n        const newScale = Math.min(this.mapScale + 2, 20)\n        this.mapScale = newScale\n        this.mapCenter = {\n          latitude: cluster.center.latitude,\n          longitude: cluster.center.longitude\n        }\n\n        // 提示用户\n        uni.showToast({\n          title: '展开查看' + (cluster.markerIds ? cluster.markerIds.length : '') + '位演员',\n          icon: 'none',\n          duration: 1500\n        })\n      }\n    },\n\n    // ========== Uni-Push 2.0 实时位置更新 ==========\n\n    // 初始化推送并订阅\n    async initPushAndSubscribe() {\n      // 如果没有位置信息，不订阅\n      if (!this.userLocation.longitude || !this.userLocation.latitude) {\n        console.log('Uni-Push: 等待获取用户位置...')\n        return\n      }\n\n      try {\n        // 1. 获取推送客户端ID\n        await this.getPushClientId()\n\n        // 2. 注册推送消息监听\n        this.registerPushListener()\n\n        // 3. 向服务器注册订阅\n        await this.subscribeToServer()\n\n        console.log('Uni-Push: 初始化完成')\n      } catch (error) {\n        console.error('Uni-Push: 初始化失败', error)\n      }\n    },\n\n    // 获取推送客户端ID\n    getPushClientId() {\n      return new Promise((resolve, reject) => {\n        // #ifdef APP-PLUS\n        // App端使用 plus.push\n        const clientInfo = plus.push.getClientInfo()\n        if (clientInfo && clientInfo.clientid) {\n          this.pushClientId = clientInfo.clientid\n          this.pushConnected = true\n          console.log('Uni-Push: 获取到clientId (App)', this.pushClientId)\n          resolve(this.pushClientId)\n        } else {\n          // 监听 clientid 获取\n          plus.push.addEventListener('receive', (msg) => {\n            // 推送消息接收\n          }, false)\n          // 延迟获取\n          setTimeout(() => {\n            const info = plus.push.getClientInfo()\n            if (info && info.clientid) {\n              this.pushClientId = info.clientid\n              this.pushConnected = true\n              resolve(this.pushClientId)\n            } else {\n              reject(new Error('Failed to get push clientId'))\n            }\n          }, 1500)\n        }\n        // #endif\n\n        // #ifdef MP-WEIXIN\n        // 小程序端使用 websocket 模拟或 订阅消息\n        // 注意：微信小程序不支持真正的推送，需要使用其他方案\n        // 这里使用 uni-id-pages 的设备ID 作为标识\n        const deviceId = uni.getStorageSync('uni_deviceId') || this.generateDeviceId()\n        this.pushClientId = deviceId\n        this.pushConnected = true\n        console.log('Uni-Push: 小程序使用deviceId', this.pushClientId)\n        resolve(this.pushClientId)\n        // #endif\n\n        // #ifdef H5\n        // H5端降级处理\n        const deviceId = uni.getStorageSync('uni_deviceId') || this.generateDeviceId()\n        this.pushClientId = deviceId\n        this.pushConnected = true\n        resolve(this.pushClientId)\n        // #endif\n      })\n    },\n\n    // 生成设备ID\n    generateDeviceId() {\n      const deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9)\n      uni.setStorageSync('uni_deviceId', deviceId)\n      return deviceId\n    },\n\n    // 注册推送消息监听\n    registerPushListener() {\n      // #ifdef APP-PLUS\n      // App端监听推送消息\n      this.pushMessageHandler = (msg) => {\n        console.log('Uni-Push: 收到推送消息', msg)\n\n        // 解析消息内容\n        let payload = null\n        if (msg.payload) {\n          payload = typeof msg.payload === 'string' ? JSON.parse(msg.payload) : msg.payload\n        } else if (msg.content) {\n          try {\n            payload = JSON.parse(msg.content)\n          } catch (e) {\n            console.warn('Uni-Push: 消息内容解析失败')\n            return\n          }\n        }\n\n        if (payload) {\n          this.handlePushMessage(payload)\n        }\n      }\n\n      // 监听透传消息\n      plus.push.addEventListener('receive', this.pushMessageHandler, false)\n      console.log('Uni-Push: 已注册App推送监听')\n      // #endif\n\n      // #ifdef MP-WEIXIN\n      // 小程序端：使用轮询或长连接模拟（实际生产中可使用云开发的实时数据推送）\n      // 这里为小程序提供一个降级方案：定时拉取更新\n      this.startMiniProgramPolling()\n      // #endif\n    },\n\n    // 小程序降级方案：定时拉取位置更新\n    startMiniProgramPolling() {\n      // 小程序不支持真正的推送，使用 30 秒轮询作为降级方案\n      // 实际生产中建议使用：\n      // 1. 云开发的实时数据推送\n      // 2. 或者微信小程序的 WebSocket\n      this.miniProgramPollingTimer = setInterval(async () => {\n        if (!this.pushConnected) return\n        try {\n          // 拉取最新位置更新\n          const pushLocationCo = uniCloud.importObject('push-location')\n          // 这里需要后端提供一个拉取接口\n          // const res = await pushLocationCo.pullLocationUpdates({ viewport: this.currentViewport })\n          // if (res.code === 0 && res.data) {\n          //   res.data.forEach(update => this.handleLocationUpdate(update))\n          // }\n        } catch (error) {\n          console.error('小程序轮询位置更新失败:', error)\n        }\n      }, 30000)\n    },\n\n    // 向服务器注册订阅\n    async subscribeToServer() {\n      if (!this.pushClientId) {\n        console.warn('Uni-Push: 无pushClientId，无法订阅')\n        return\n      }\n\n      try {\n        const pushLocationCo = uniCloud.importObject('push-location')\n        const res = await pushLocationCo.subscribe({\n          push_clientid: this.pushClientId,\n          viewport: this.currentViewport,\n          user_location: this.userLocation,\n          role: 'crew',\n          platform: this.getPlatform()\n        })\n\n        if (res.code === 0) {\n          console.log('Uni-Push: 订阅成功')\n        } else {\n          console.error('Uni-Push: 订阅失败', res.msg)\n        }\n      } catch (error) {\n        console.error('Uni-Push: 订阅请求失败', error)\n      }\n    },\n\n    // 更新订阅（视口变化时调用）\n    async updateSubscription() {\n      if (!this.pushClientId || !this.pushConnected) return\n\n      try {\n        const pushLocationCo = uniCloud.importObject('push-location')\n        await pushLocationCo.setActive({\n          is_active: true,\n          viewport: this.currentViewport,\n          user_location: this.userLocation\n        })\n        console.log('Uni-Push: 订阅已更新')\n      } catch (error) {\n        console.error('Uni-Push: 更新订阅失败', error)\n      }\n    },\n\n    // 设置订阅为非活跃状态\n    async setSubscriptionInactive() {\n      if (!this.pushClientId) return\n\n      try {\n        const pushLocationCo = uniCloud.importObject('push-location')\n        await pushLocationCo.setActive({\n          is_active: false\n        })\n        console.log('Uni-Push: 已设置为非活跃')\n      } catch (error) {\n        console.error('Uni-Push: 设置非活跃失败', error)\n      }\n    },\n\n    // 取消订阅\n    async unsubscribePush() {\n      // #ifdef APP-PLUS\n      // 移除推送监听\n      if (this.pushMessageHandler) {\n        plus.push.removeEventListener('receive', this.pushMessageHandler)\n        this.pushMessageHandler = null\n      }\n      // #endif\n\n      // #ifdef MP-WEIXIN\n      // 停止小程序轮询\n      if (this.miniProgramPollingTimer) {\n        clearInterval(this.miniProgramPollingTimer)\n        this.miniProgramPollingTimer = null\n      }\n      // #endif\n\n      // 通知服务器取消订阅\n      if (this.pushClientId) {\n        try {\n          const pushLocationCo = uniCloud.importObject('push-location')\n          await pushLocationCo.unsubscribe({})\n        } catch (error) {\n          console.error('Uni-Push: 取消订阅失败', error)\n        }\n      }\n\n      this.pushConnected = false\n      console.log('Uni-Push: 已取消订阅')\n    },\n\n    // 处理推送消息\n    handlePushMessage(message) {\n      console.log('Uni-Push: 处理消息', message)\n\n      if (!message || !message.type) {\n        console.warn('Uni-Push: 无效消息格式')\n        return\n      }\n\n      switch (message.type) {\n        case 'location-update':\n          // 演员位置更新\n          this.handleLocationUpdate(message.data)\n          break\n\n        case 'actor-online':\n          // 演员上线\n          this.handleActorOnline(message.data)\n          break\n\n        case 'actor-offline':\n          // 演员下线\n          this.handleActorOffline(message.data)\n          break\n\n        default:\n          console.log('Uni-Push: 未知消息类型', message.type)\n      }\n    },\n\n    // 获取平台类型\n    getPlatform() {\n      // #ifdef APP-PLUS\n      return 'app'\n      // #endif\n      // #ifdef MP-WEIXIN\n      return 'mp-weixin'\n      // #endif\n      // #ifdef H5\n      return 'h5'\n      // #endif\n      return 'unknown'\n    },\n\n    // 处理位置更新事件 - 增量更新 + 平滑移动\n    handleLocationUpdate(data) {\n      // data格式: { actor_id: 'xxx', latitude: 29.5630, longitude: 106.4650, timestamp: 1704700000000 }\n      // 或批量: [{ actor_id, latitude, longitude, timestamp }, ...]\n\n      const updates = Array.isArray(data) ? data : [data]\n\n      updates.forEach(update => {\n        const { actor_id, latitude, longitude } = update\n\n        if (!actor_id || latitude == null || longitude == null) {\n          return\n        }\n\n        // 1. 查找并更新 actorMarkerData 中的数据\n        const markerIndex = this.actorMarkerData.findIndex(m => m.id === actor_id)\n        if (markerIndex !== -1) {\n          const oldLat = this.actorMarkerData[markerIndex].latitude\n          const oldLng = this.actorMarkerData[markerIndex].longitude\n\n          // 更新数据\n          this.actorMarkerData[markerIndex].latitude = latitude\n          this.actorMarkerData[markerIndex].longitude = longitude\n\n          // 2. 使用 translateMarker 实现平滑移动\n          this.smoothMoveMarker(actor_id, oldLat, oldLng, latitude, longitude)\n        }\n\n        // 3. 同步更新 actorList 中的数据\n        const actorIndex = this.actorList.findIndex(a => a.id === actor_id || a._id === actor_id)\n        if (actorIndex !== -1) {\n          this.actorList[actorIndex].latitude = latitude\n          this.actorList[actorIndex].longitude = longitude\n        }\n\n        // 4. 更新 actorMarkers 数组中的对应项\n        const markersIndex = this.actorMarkers.findIndex(m => m.id === actor_id)\n        if (markersIndex !== -1) {\n          this.$set(this.actorMarkers[markersIndex], 'latitude', latitude)\n          this.$set(this.actorMarkers[markersIndex], 'longitude', longitude)\n        }\n      })\n\n      console.log('Uni-Push: 处理位置更新', updates.length, '条')\n    },\n\n    // 平滑移动Marker\n    smoothMoveMarker(markerId, fromLat, fromLng, toLat, toLng) {\n      if (!this.mapContext) {\n        console.warn('smoothMoveMarker: mapContext未初始化')\n        return\n      }\n\n      // 如果位置变化很小，不执行动画\n      const latDiff = Math.abs(toLat - fromLat)\n      const lngDiff = Math.abs(toLng - fromLng)\n      if (latDiff < 0.00001 && lngDiff < 0.00001) {\n        return\n      }\n\n      // 使用 translateMarker 实现平滑移动动画\n      this.mapContext.translateMarker({\n        markerId: markerId,\n        destination: {\n          latitude: toLat,\n          longitude: toLng\n        },\n        duration: this.markerAnimationDuration,\n        autoRotate: false,\n        success: () => {\n          // 动画完成\n        },\n        fail: (err) => {\n          // translateMarker 失败时，直接更新位置\n          console.warn('translateMarker失败，直接更新位置:', err)\n          this.updateActorMarkers()\n        }\n      })\n    },\n\n    // 处理演员上线事件\n    handleActorOnline(data) {\n      const { actor_id, latitude, longitude, actor_info } = data\n\n      // 检查是否已存在\n      const existingIndex = this.actorMarkerData.findIndex(m => m.id === actor_id)\n\n      if (existingIndex !== -1) {\n        // 已存在，更新状态\n        this.actorMarkerData[existingIndex].isOnline = true\n        this.actorMarkerData[existingIndex].latitude = latitude\n        this.actorMarkerData[existingIndex].longitude = longitude\n      } else if (actor_info) {\n        // 不存在且有演员信息，添加新标记\n        this.actorMarkerData.push({\n          id: actor_id,\n          latitude: latitude,\n          longitude: longitude,\n          avatar: actor_info.avatar || this.defaultAvatarPath,\n          isOnline: true,\n          nickname: actor_info.nickname || '--',\n          height: actor_info.height || 170\n        })\n      }\n\n      // 更新地图标记\n      this.updateActorMarkers()\n      console.log('Uni-Push: 演员上线', actor_id)\n    },\n\n    // 处理演员下线事件\n    handleActorOffline(data) {\n      const { actor_id } = data\n\n      // 更新在线状态\n      const markerIndex = this.actorMarkerData.findIndex(m => m.id === actor_id)\n      if (markerIndex !== -1) {\n        this.actorMarkerData[markerIndex].isOnline = false\n      }\n\n      const actorIndex = this.actorList.findIndex(a => a.id === actor_id || a._id === actor_id)\n      if (actorIndex !== -1) {\n        this.actorList[actorIndex].isOnline = false\n      }\n\n      // 更新地图标记（更新callout颜色等）\n      this.updateActorMarkers()\n      console.log('Uni-Push: 演员下线', actor_id)\n    },\n\n    showActorDetail(actor) {\n      this.selectedActor = actor\n      this.$refs.actorDetailPopup.open()\n    },\n\n    closeActorDetail() {\n      this.$refs.actorDetailPopup.close()\n    },\n\n    inviteActor() {\n      if (!this.requireLogin('邀请演员')) return\n      uni.showToast({\n        title: '邀请功能开发中',\n        icon: 'none'\n      })\n    },\n\n    // ========== 抽屉相关 ==========\n    onDrawerTouchStart(e) {\n      this.touchStartY = e.touches[0].clientY\n      this.drawerStartHeight = this.drawerHeight\n      this.isDragging = true\n    },\n\n    onDrawerTouchMove(e) {\n      if (!this.isDragging) return\n\n      const currentY = e.touches[0].clientY\n      const deltaY = this.touchStartY - currentY\n      const deltaRpx = deltaY * 2\n\n      let newHeight = this.drawerStartHeight + deltaRpx\n\n      if (newHeight < this.drawerMinHeight) {\n        newHeight = this.drawerMinHeight\n      }\n      if (newHeight > this.drawerMaxHeight) {\n        newHeight = this.drawerMaxHeight\n      }\n\n      this.drawerHeight = newHeight\n    },\n\n    onDrawerTouchEnd(e) {\n      this.isDragging = false\n      this.touchStartY = 0\n      this.drawerStartHeight = 0\n    },\n\n    // ========== 搜索 ==========\n    onSearchInput() {\n      // 清除之前的防抖定时器\n      if (this.searchTimer) {\n        clearTimeout(this.searchTimer)\n      }\n\n      const keyword = this.searchKeyword.trim()\n      if (!keyword) {\n        this.searchResults = []\n        this.searchLoading = false\n        return\n      }\n\n      // 显示loading状态\n      this.searchLoading = true\n\n      // 防抖：500ms后调用后端搜索接口\n      this.searchTimer = setTimeout(() => {\n        this.searchActorsFromApi(keyword)\n      }, 500)\n    },\n\n    // 调用后端搜索接口\n    async searchActorsFromApi(keyword) {\n      if (!keyword) {\n        this.searchResults = []\n        this.searchLoading = false\n        return\n      }\n\n      try {\n        const orderCo = uniCloud.importObject('order-co')\n\n        // 构建搜索参数\n        const params = {\n          keyword: keyword,\n          // 传递用户位置用于计算距离和排序\n          userLongitude: this.userLocation.longitude,\n          userLatitude: this.userLocation.latitude,\n          // 可选：限制搜索结果数量\n          limit: 50\n        }\n\n        console.log('搜索演员, 关键字:', keyword, '参数:', params)\n\n        const res = await orderCo.searchActors(params)\n\n        if (res.code === 0 && res.data) {\n          // 处理搜索结果数据\n          const skillLabelMap = {\n            'driving': '开车',\n            'dancing': '跳舞',\n            'singing': '唱歌',\n            'martial_arts': '武术',\n            'swimming': '游泳',\n            'riding': '骑马',\n            'instrument': '乐器',\n            'language': '外语'\n          }\n\n          const bodyTypeMap = {\n            'slim': '偏瘦',\n            'standard': '标准',\n            'athletic': '健壮',\n            'plump': '偏胖'\n          }\n\n          this.searchResults = res.data.map((actor, index) => {\n            const avatarFile = actor.avatar_file\n            const avatarUrl = (avatarFile && avatarFile.url) || actor.avatar || this.defaultAvatarPath\n\n            // 确定演员位置\n            const isOnline = actor.online_status === 1\n            let actorLat = null\n            let actorLng = null\n\n            if (isOnline && actor.current_location) {\n              actorLat = actor.current_location.coordinates[1]\n              actorLng = actor.current_location.coordinates[0]\n            } else if (actor.last_login_location) {\n              actorLat = actor.last_login_location.coordinates[1]\n              actorLng = actor.last_login_location.coordinates[0]\n            } else if (actor.location) {\n              actorLat = actor.location.coordinates[1]\n              actorLng = actor.location.coordinates[0]\n            }\n\n            return {\n              id: actor._id || index + 1,\n              _id: actor._id,\n              nickname: actor.nickname || '--',\n              avatar: avatarUrl,\n              height: actor.height || 170,\n              gender: actor.gender || 0,\n              bodyType: bodyTypeMap[actor.body_type] || actor.body_type || '--',\n              credit_score: actor.credit_score_actor || 100,\n              distance: actor.distance_km ? parseFloat(actor.distance_km).toFixed(1) : '-',\n              skills: (actor.skills || []).map(s => skillLabelMap[s] || s),\n              latitude: actorLat,\n              longitude: actorLng,\n              videoCard: actor.video_card || actor.video_card_url || '',\n              isOnline: isOnline,\n              lastActiveTime: actor.last_active_time || null\n            }\n          })\n\n          console.log('搜索结果:', this.searchResults.length, '条')\n        } else {\n          this.searchResults = []\n          if (res.code !== 0) {\n            console.error('搜索失败:', res.message || res.msg)\n          }\n        }\n      } catch (error) {\n        console.error('搜索演员失败:', error)\n        this.searchResults = []\n        uni.showToast({\n          title: '搜索失败，请重试',\n          icon: 'none'\n        })\n      } finally {\n        this.searchLoading = false\n      }\n    },\n\n    // 点击搜索结果项 - 定位到地图并显示详情\n    onSearchResultTap(actor) {\n      if (!actor) return\n\n      // 1. 收起抽屉以便查看地图\n      this.drawerHeight = this.drawerMinHeight\n\n      // 2. 移动地图中心到该演员位置\n      if (actor.latitude && actor.longitude) {\n        // 放大地图比例\n        this.mapScale = 17\n\n        // 使用 $set 确保响应式更新地图中心点\n        this.$set(this.mapCenter, 'latitude', actor.latitude)\n        this.$set(this.mapCenter, 'longitude', actor.longitude)\n\n        console.log('地图聚焦到演员位置:', actor.nickname, actor.latitude, actor.longitude)\n\n        // 如果有 mapContext，尝试使用 includePoints 确保视图包含该点\n        if (this.mapContext) {\n          this.mapContext.includePoints({\n            points: [{\n              latitude: actor.latitude,\n              longitude: actor.longitude\n            }],\n            padding: [50, 50, 50, 50],\n            success: () => {\n              console.log('includePoints 成功')\n            },\n            fail: (err) => {\n              console.warn('includePoints 失败:', err)\n            }\n          })\n        }\n      }\n\n      // 3. 显示演员详情弹窗\n      // 延迟显示弹窗，确保地图移动完成\n      setTimeout(() => {\n        this.showActorDetail(actor)\n      }, 300)\n    },\n\n    clearSearch() {\n      this.searchKeyword = ''\n      this.searchResults = []\n      this.searchLoading = false\n    },\n\n    // ========== 登录检查 ==========\n    checkLoginStatus() {\n      try {\n        const token = uni.getStorageSync('uni_id_token')\n        const tokenExpired = uni.getStorageSync('uni_id_token_expired')\n        return token && tokenExpired && tokenExpired > Date.now()\n      } catch (error) {\n        return false\n      }\n    },\n\n    requireLogin(actionName = '此操作') {\n      if (this.isLoggedIn) return true\n\n      uni.showModal({\n        title: '需要登录',\n        content: `${actionName}需要登录后才能使用，是否现在登录？`,\n        confirmText: '去登录',\n        success: (res) => {\n          if (res.confirm) {\n            uni.setStorageSync('selected_role', 'crew')\n            uni.navigateTo({\n              url: '/uni_modules/uni-id-pages/pages/login/login-withpwd'\n            })\n          }\n        }\n      })\n      return false\n    },\n\n    async loadUserInfo() {\n      try {\n        const res = await uniCloud.getCurrentUserInfo()\n        this.userInfo = res\n      } catch (error) {\n        console.error('加载用户信息失败:', error)\n      }\n    },\n\n    async loadStats() {\n      try {\n        const token = uni.getStorageSync('uni_id_token')\n        if (!token) return\n\n        const userCo = uniCloud.importObject('user-co')\n        const res = await userCo.getStats()\n\n        if (res.code === 0 && res.data) {\n          this.stats = {\n            pending: res.data.pending || 0,\n            ongoing: res.data.in_progress || 0,\n            completed: res.data.completed || 0\n          }\n          if (res.data.credit_score) {\n            this.userInfo.credit_score_crew = res.data.credit_score\n          }\n        }\n      } catch (error) {\n        console.error('加载统计失败:', error)\n      }\n    },\n\n    async loadRecentOrders() {\n      try {\n        const token = uni.getStorageSync('uni_id_token')\n        if (!token) return\n\n        const orderCo = uniCloud.importObject('order-co')\n        const res = await orderCo.getMyOrders({\n          page: 1,\n          pageSize: 5\n        })\n\n        if (res.code === 0) {\n          this.orderList = res.data.list\n        } else if (res.code === 401) {\n          uni.reLaunch({\n            url: '/pages/index/index'\n          })\n        }\n      } catch (error) {\n        console.error('加载订单失败:', error)\n        if (error.message && error.message.includes('登录')) {\n          uni.reLaunch({\n            url: '/pages/index/index'\n          })\n        }\n      }\n    },\n\n    goToPostOrder() {\n      if (!this.requireLogin('发布需求')) return\n      uni.navigateTo({\n        url: '/pages/crew/post_order'\n      })\n    },\n\n    goToOrderList() {\n      if (!this.requireLogin('查看订单')) return\n      uni.navigateTo({\n        url: '/pages/crew/order_list'\n      })\n    },\n\n    goToOrderDetail(orderId) {\n      if (!this.requireLogin('查看订单详情')) return\n      uni.navigateTo({\n        url: `/pages/crew/order_detail?id=${orderId}`\n      })\n    },\n\n    goToProfile() {\n      if (!this.requireLogin('查看个人中心')) return\n      uni.navigateTo({\n        url: '/pages/crew/profile'\n      })\n    },\n\n    // ========== 工具方法 ==========\n    getCreditClass(score) {\n      if (score >= 130) return 'credit-gold'\n      if (score >= 110) return 'credit-silver'\n      return 'credit-normal'\n    },\n\n    getCreditLevel(score) {\n      if (score >= 130) return '金牌剧组'\n      if (score >= 110) return '优质剧组'\n      if (score >= 90) return '良好'\n      return '普通'\n    },\n\n    getStatusText(status) {\n      const textMap = {\n        0: '待接单',\n        1: '进行中',\n        2: '待支付',\n        3: '已完成',\n        4: '已取消'\n      }\n      return textMap[status] || '未知'\n    },\n\n    formatTime(timestamp) {\n      const date = new Date(timestamp)\n      const now = new Date()\n      const diff = now - date\n\n      if (diff < 60000) return '刚刚'\n      if (diff < 3600000) return `${Math.floor(diff / 60000)}分钟前`\n      if (diff < 86400000) return `${Math.floor(diff / 3600000)}小时前`\n      if (diff < 604800000) return `${Math.floor(diff / 86400000)}天前`\n\n      return `${date.getMonth() + 1}-${date.getDate()}`\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import '@/common/theme.scss';\n\n.crew-home-map {\n  width: 100%;\n  height: 100vh;\n  position: relative;\n  background-color: $bg-primary;\n}\n\n// ========== 地图层 ==========\n.map-layer {\n  width: 100%;\n  height: 100%;\n}\n\n// ========== 我的图标 ==========\n.my-profile-icon-crew {\n  position: absolute;\n  left: 32rpx;\n  top: 60rpx;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  width: 100rpx;\n  height: 100rpx;\n  background-color: rgba(255, 255, 255, 0.95);\n  border-radius: 20rpx;\n  box-shadow: 0 8rpx 16rpx rgba(0, 0, 0, 0.15);\n}\n\n.my-icon-circle {\n  width: 48rpx;\n  height: 48rpx;\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.my-icon-head {\n  width: 20rpx;\n  height: 20rpx;\n  background-color: #333;\n  border-radius: 50%;\n}\n\n.my-icon-body {\n  width: 32rpx;\n  height: 18rpx;\n  background-color: #333;\n  border-radius: 16rpx 16rpx 0 0;\n  margin-top: 4rpx;\n}\n\n.my-text-crew {\n  font-size: 20rpx;\n  color: #333;\n  font-weight: 600;\n  margin-top: 4rpx;\n}\n\n// ========== 底部抽屉 ==========\n.drawer-container {\n  position: fixed;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: $bg-secondary;\n  border-radius: $border-radius-lg $border-radius-lg 0 0;\n  z-index: $z-index-drawer;\n  box-shadow: 0 -4rpx 16rpx rgba(0, 0, 0, 0.3);\n  will-change: height;\n}\n\n.drawer-handle-area {\n  padding: $spacing-sm 0;\n  @include flex-center;\n}\n\n.drawer-handle {\n  width: 80rpx;\n  height: 8rpx;\n  background-color: $gray-3;\n  border-radius: 4rpx;\n}\n\n.drawer-content {\n  padding: 0 $spacing-base $spacing-base;\n  box-sizing: border-box;\n}\n\n// ========== 搜索栏 ==========\n.search-bar {\n  display: flex;\n  align-items: center;\n  background-color: $bg-tertiary;\n  border-radius: $border-radius-base;\n  padding: $spacing-sm $spacing-base;\n  margin-bottom: $spacing-base;\n  gap: $spacing-sm;\n}\n\n.search-input {\n  flex: 1;\n  color: $text-primary;\n  font-size: $font-size-base;\n}\n\n.search-placeholder {\n  color: $text-hint;\n}\n\n.search-clear {\n  @include flex-center;\n}\n\n// ========== 搜索结果 ==========\n.search-results {\n  margin-bottom: $spacing-base;\n}\n\n.result-count {\n  font-size: $font-size-sm;\n  color: $text-secondary;\n}\n\n.search-list {\n  display: flex;\n  flex-direction: column;\n  gap: $spacing-sm;\n}\n\n.search-item {\n  display: flex;\n  align-items: center;\n  background-color: $bg-tertiary;\n  border-radius: $border-radius-base;\n  padding: $spacing-base;\n  gap: $spacing-base;\n\n  &:active {\n    opacity: 0.8;\n  }\n}\n\n.actor-avatar {\n  width: 80rpx;\n  height: 80rpx;\n  border-radius: $border-radius-circle;\n  background-color: $gray-4;\n}\n\n.actor-info {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 8rpx;\n}\n\n.actor-name {\n  font-size: $font-size-lg;\n  font-weight: $font-weight-medium;\n  color: $text-primary;\n}\n\n.actor-meta {\n  display: flex;\n  align-items: center;\n  gap: 8rpx;\n  font-size: $font-size-sm;\n  color: $text-secondary;\n}\n\n.meta-item {\n  font-family: $font-family-monospace;\n}\n\n.meta-divider {\n  color: $gray-3;\n}\n\n.credit-badge {\n  padding: 8rpx 16rpx;\n  border-radius: $border-radius-sm;\n  font-size: $font-size-sm;\n  font-weight: $font-weight-bold;\n\n  &.credit-gold {\n    @include credit-badge('gold');\n  }\n\n  &.credit-silver {\n    @include credit-badge('silver');\n  }\n\n  &.credit-normal {\n    @include credit-badge('normal');\n  }\n}\n\n// ========== 搜索Loading ==========\n.search-loading {\n  padding: $spacing-lg 0;\n  @include flex-center;\n  @include flex-column;\n  gap: $spacing-sm;\n\n  .loading-spinner {\n    width: 40rpx;\n    height: 40rpx;\n    border: 4rpx solid $gray-3;\n    border-top-color: $primary-color;\n    border-radius: 50%;\n    animation: spin 0.8s linear infinite;\n  }\n\n  .loading-text {\n    font-size: $font-size-sm;\n    color: $text-secondary;\n  }\n}\n\n@keyframes spin {\n  from { transform: rotate(0deg); }\n  to { transform: rotate(360deg); }\n}\n\n.empty-search {\n  padding: $spacing-lg 0;\n  text-align: center;\n\n  .empty-text {\n    font-size: $font-size-base;\n    color: $text-secondary;\n  }\n}\n\n// ========== 主内容区 ==========\n.main-content {\n  display: flex;\n  flex-direction: column;\n  gap: $spacing-base;\n}\n\n// ========== 最近订单 ==========\n.recent-orders-compact {\n  padding: $spacing-base;\n  background-color: $bg-tertiary;\n  border-radius: $border-radius-base;\n}\n\n.section-header-compact {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: $spacing-base;\n\n  .section-title-text {\n    font-size: $font-size-lg;\n    font-weight: $font-weight-bold;\n    color: $text-primary;\n  }\n\n  .more-link {\n    display: flex;\n    align-items: center;\n    gap: 4rpx;\n    font-size: $font-size-sm;\n    color: $primary-color;\n  }\n}\n\n.order-list-compact {\n  display: flex;\n  flex-direction: column;\n  gap: $spacing-sm;\n}\n\n.order-item-compact {\n  padding: $spacing-sm;\n  background-color: $bg-primary;\n  border-radius: $border-radius-sm;\n\n  &:active {\n    opacity: 0.8;\n  }\n}\n\n.order-header-compact {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 8rpx;\n\n  .order-status-compact {\n    padding: 4rpx 12rpx;\n    border-radius: 8rpx;\n    font-size: $font-size-xs;\n    font-weight: $font-weight-medium;\n\n    &.status-pending {\n      @include status-tag($warning-color);\n    }\n\n    &.status-ongoing {\n      @include status-tag($secondary-color);\n    }\n\n    &.status-completed {\n      @include status-tag($success-color);\n    }\n  }\n\n  .order-time-compact {\n    font-size: $font-size-xs;\n    color: $text-hint;\n  }\n}\n\n.order-content-compact {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n\n  .order-location {\n    flex: 1;\n    font-size: $font-size-sm;\n    color: $text-secondary;\n    @include text-ellipsis;\n  }\n\n  .order-price {\n    font-size: $font-size-lg;\n    font-weight: $font-weight-bold;\n    color: $primary-color;\n    font-family: $font-family-monospace;\n\n    &::before {\n      content: '\\00A5';\n    }\n  }\n}\n\n.empty-orders-compact {\n  padding: $spacing-lg 0;\n  text-align: center;\n\n  .empty-text-compact {\n    font-size: $font-size-sm;\n    color: $text-secondary;\n  }\n}\n\n// ========== 信用分 ==========\n.credit-section-compact {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: $spacing-base;\n  background: linear-gradient(135deg, rgba($primary-color, 0.2) 0%, rgba($secondary-color, 0.2) 100%);\n  border-radius: $border-radius-base;\n}\n\n.credit-info {\n  display: flex;\n  align-items: baseline;\n  gap: $spacing-sm;\n\n  .credit-title-compact {\n    font-size: $font-size-sm;\n    color: $text-secondary;\n  }\n\n  .credit-score-compact {\n    display: flex;\n    align-items: baseline;\n    gap: 4rpx;\n\n    .score-value {\n      font-size: 40rpx;\n      font-weight: $font-weight-bold;\n      color: $primary-color;\n      font-family: $font-family-monospace;\n    }\n\n    .score-max {\n      font-size: $font-size-sm;\n      color: $text-secondary;\n    }\n  }\n}\n\n.credit-level-badge {\n  padding: 8rpx 20rpx;\n  border-radius: $border-radius-sm;\n  font-size: $font-size-sm;\n  font-weight: $font-weight-bold;\n\n  &.level-gold {\n    @include credit-badge('gold');\n  }\n\n  &.level-silver {\n    @include credit-badge('silver');\n  }\n\n  &.level-normal {\n    @include credit-badge('normal');\n  }\n}\n\n// ========== FAB 悬浮按钮 ==========\n.fab {\n  position: fixed;\n  right: 32rpx;\n  bottom: 120rpx;\n  width: 112rpx;\n  height: 112rpx;\n  z-index: 999;\n\n  .fab-bg {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 112rpx;\n    height: 112rpx;\n    background-color: #FFD700;\n    border-radius: 56rpx;\n  }\n\n  .fab-icon {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 112rpx;\n    height: 112rpx;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    font-size: 72rpx;\n    font-weight: 200;\n    color: #000000;\n    line-height: 112rpx;\n    text-align: center;\n  }\n}\n\n// ========== 演员详情弹窗 ==========\n.actor-detail-popup {\n  background-color: $bg-secondary;\n  border-radius: $border-radius-lg $border-radius-lg 0 0;\n  max-height: 90vh;\n  overflow: hidden;\n}\n\n.popup-header {\n  position: relative;\n  padding: $spacing-lg;\n  background: linear-gradient(135deg, $primary-color 0%, #FFED4E 100%);\n  text-align: center;\n\n  .popup-title {\n    font-size: $font-size-xl;\n    font-weight: $font-weight-bold;\n    color: $black;\n  }\n\n  .popup-close {\n    position: absolute;\n    right: $spacing-lg;\n    top: $spacing-lg;\n  }\n}\n\n.actor-detail-content {\n  padding: $spacing-lg;\n}\n\n.video-card-preview {\n  width: 100%;\n  height: 400rpx;\n  background-color: $bg-tertiary;\n  border-radius: $border-radius-base;\n  margin-bottom: $spacing-lg;\n  overflow: hidden;\n\n  .video-player {\n    width: 100%;\n    height: 100%;\n  }\n\n  .video-placeholder {\n    width: 100%;\n    height: 100%;\n    @include flex-center;\n    @include flex-column;\n    gap: $spacing-base;\n\n    .placeholder-text {\n      font-size: $font-size-base;\n      color: $text-secondary;\n    }\n  }\n}\n\n.detail-info-grid {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: $spacing-base;\n  margin-bottom: $spacing-lg;\n}\n\n.info-item {\n  display: flex;\n  flex-direction: column;\n  gap: 8rpx;\n\n  .info-label {\n    font-size: $font-size-sm;\n    color: $text-secondary;\n  }\n\n  .info-value {\n    font-size: $font-size-lg;\n    font-weight: $font-weight-medium;\n    color: $text-primary;\n  }\n}\n\n.detail-skills {\n  margin-bottom: $spacing-lg;\n\n  .skills-label {\n    display: block;\n    font-size: $font-size-sm;\n    color: $text-secondary;\n    margin-bottom: $spacing-sm;\n  }\n\n  .skills-list {\n    display: flex;\n    flex-wrap: wrap;\n    gap: $spacing-sm;\n  }\n\n  .skill-tag-large {\n    padding: 8rpx 20rpx;\n    background-color: rgba($primary-color, 0.15);\n    border: 1rpx solid $primary-color;\n    border-radius: $border-radius-base;\n    color: $primary-color;\n    font-size: $font-size-base;\n  }\n}\n\n.btn-invite {\n  @include button-primary;\n  width: 100%;\n  margin-top: $spacing-base;\n}\n</style>\n","import mod from \"-!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&id=0e9da1dd&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&id=0e9da1dd&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1768460232190\n      var cssReload = require(\"D:/HBuilderX.4.87.2025121004/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}