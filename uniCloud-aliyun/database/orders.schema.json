{
  "bsonType": "object",
  "required": ["publisher_id", "order_status", "meeting_location_name", "meeting_time"],
  "permission": {
    "read": true,
    "create": "auth.uid != null",
    "update": "doc.publisher_id == auth.uid || doc.receiver_id == auth.uid",
    "delete": "doc.publisher_id == auth.uid && doc.order_status == 0"
  },
  "properties": {
    "_id": {
      "description": "订单ID,系统自动生成"
    },
    "publisher_id": {
      "bsonType": "string",
      "title": "发布者ID",
      "description": "发布订单的用户ID(剧组方)",
      "foreignKey": "uni-id-users._id"
    },
    "receiver_id": {
      "bsonType": "string",
      "title": "接单者ID",
      "description": "接单的用户ID(演员方) - 兼容单人模式",
      "foreignKey": "uni-id-users._id"
    },
    "receivers": {
      "bsonType": "array",
      "title": "接单者列表",
      "description": "多人接单模式下的接单者ID列表",
      "items": {
        "bsonType": "string"
      }
    },
    "applicants": {
      "bsonType": "array",
      "title": "申请者列表",
      "description": "申请该订单的演员及其状态",
      "items": {
        "bsonType": "object",
        "properties": {
          "actor_id": {
            "bsonType": "string",
            "title": "演员ID",
            "foreignKey": "uni-id-users._id"
          },
          "status": {
            "bsonType": "string",
            "title": "申请状态",
            "description": "pending-待审核, approved-已通过, rejected-已拒绝",
            "enum": ["pending", "approved", "rejected"]
          },
          "apply_time": {
            "bsonType": "timestamp",
            "title": "申请时间"
          },
          "review_time": {
            "bsonType": "timestamp",
            "title": "审核时间"
          },
          "reject_reason": {
            "bsonType": "string",
            "title": "拒绝原因"
          }
        }
      }
    },
    "order_status": {
      "bsonType": "int",
      "title": "订单状态",
      "description": "订单状态: 0-待接单, 1-进行中, 2-待支付, 3-已完成, 4-已取消",
      "defaultValue": 0,
      "enum": [
        {
          "text": "待接单",
          "value": 0
        },
        {
          "text": "进行中",
          "value": 1
        },
        {
          "text": "待支付",
          "value": 2
        },
        {
          "text": "已完成",
          "value": 3
        },
        {
          "text": "已取消",
          "value": 4
        }
      ]
    },
    "create_time": {
      "bsonType": "timestamp",
      "title": "创建时间",
      "description": "订单创建时间",
      "forceDefaultValue": {
        "$env": "now"
      }
    },
    "update_time": {
      "bsonType": "timestamp",
      "title": "更新时间",
      "description": "订单最后更新时间"
    },
    "meeting_location_name": {
      "bsonType": "string",
      "title": "集合地点名称",
      "description": "集合地点的名称或地址",
      "trim": "both"
    },
    "meeting_location": {
      "bsonType": "object",
      "title": "集合地点坐标",
      "description": "集合地点的经纬度信息",
      "properties": {
        "type": {
          "bsonType": "string",
          "description": "GeoJSON类型",
          "enum": ["Point"]
        },
        "coordinates": {
          "bsonType": "array",
          "description": "经纬度坐标 [longitude, latitude]"
        }
      }
    },
    "meeting_time": {
      "bsonType": "timestamp",
      "title": "集合时间",
      "description": "要求演员到达的集合时间"
    },
    "gender_requirement": {
      "bsonType": "int",
      "title": "性别要求",
      "description": "性别要求: 0-不限, 1-男, 2-女",
      "defaultValue": 0,
      "enum": [
        {
          "text": "不限",
          "value": 0
        },
        {
          "text": "男",
          "value": 1
        },
        {
          "text": "女",
          "value": 2
        }
      ]
    },
    "height_min": {
      "bsonType": "int",
      "title": "最低身高",
      "description": "最低身高要求(cm),0表示不限",
      "minimum": 0,
      "maximum": 250,
      "defaultValue": 0
    },
    "height_max": {
      "bsonType": "int",
      "title": "最高身高",
      "description": "最高身高要求(cm),0表示不限",
      "minimum": 0,
      "maximum": 250,
      "defaultValue": 0
    },
    "body_type": {
      "bsonType": "array",
      "title": "体型要求",
      "description": "体型要求,可多选",
      "items": {
        "bsonType": "string",
        "enum": ["slim", "normal", "athletic", "plus"]
      }
    },
    "special_skills": {
      "bsonType": "array",
      "title": "特长要求",
      "description": "特长要求,如开车/跳舞等",
      "items": {
        "bsonType": "string"
      }
    },
    "welfare_tags": {
      "bsonType": "array",
      "title": "福利标签",
      "description": "福利标签,如包盒饭/报销路费等",
      "items": {
        "bsonType": "string",
        "enum": ["meal", "taxi", "accommodation", "tea", "other"]
      }
    },
    "price_type": {
      "bsonType": "string",
      "title": "计费方式",
      "description": "计费方式: daily-按天, hourly-按时",
      "enum": [
        {
          "text": "按天",
          "value": "daily"
        },
        {
          "text": "按时",
          "value": "hourly"
        }
      ]
    },
    "price_amount": {
      "bsonType": "int",
      "title": "金额",
      "description": "金额(分为单位)",
      "minimum": 0
    },
    "order_type": {
      "bsonType": "string",
      "title": "订单类型",
      "description": "订单类型: immediate-即时单(<2h), reservation-预约单(>2h)",
      "enum": [
        {
          "text": "即时单",
          "value": "immediate"
        },
        {
          "text": "预约单",
          "value": "reservation"
        }
      ]
    },
    "start_off_time": {
      "bsonType": "timestamp",
      "title": "出发时间",
      "description": "演员点击我已出发的时间"
    },
    "tracking_started": {
      "bsonType": "bool",
      "title": "轨迹追踪开始",
      "description": "是否已开始轨迹追踪",
      "defaultValue": false
    },
    "tracking_start_time": {
      "bsonType": "timestamp",
      "title": "追踪开始时间",
      "description": "开始轨迹追踪的时间"
    },
    "actor_cancel_reason": {
      "bsonType": "string",
      "title": "演员取消原因",
      "description": "演员取消订单的原因(如无法到达)",
      "trim": "both"
    },
    "arrive_time": {
      "bsonType": "timestamp",
      "title": "到达时间",
      "description": "演员到达集合地点打卡的时间"
    },
    "finish_time": {
      "bsonType": "timestamp",
      "title": "完工时间",
      "description": "工作完成的时间"
    },
    "cancel_time": {
      "bsonType": "timestamp",
      "title": "取消时间",
      "description": "订单取消的时间"
    },
    "cancel_reason": {
      "bsonType": "string",
      "title": "取消原因",
      "description": "订单取消的原因",
      "trim": "both"
    },
    "cancel_by": {
      "bsonType": "string",
      "title": "取消操作人",
      "description": "取消订单的用户ID",
      "foreignKey": "uni-id-users._id"
    },
    "people_needed": {
      "bsonType": "int",
      "title": "需要人数",
      "description": "需要的演员人数",
      "minimum": 1,
      "defaultValue": 1
    },
    "role_description": {
      "bsonType": "string",
      "title": "角色描述",
      "description": "角色/工作内容描述",
      "trim": "both"
    },
    "remark": {
      "bsonType": "string",
      "title": "备注",
      "description": "其他备注信息",
      "trim": "both"
    },
    "publisher_rating": {
      "bsonType": "object",
      "title": "剧组评价",
      "description": "剧组对演员的评价",
      "properties": {
        "score": {
          "bsonType": "int",
          "title": "评分",
          "description": "评分(1-5星)",
          "minimum": 1,
          "maximum": 5
        },
        "comment": {
          "bsonType": "string",
          "title": "评价内容",
          "description": "评价文字内容",
          "trim": "both"
        },
        "create_time": {
          "bsonType": "timestamp",
          "title": "评价时间",
          "description": "评价创建时间"
        }
      }
    },
    "receiver_rating": {
      "bsonType": "object",
      "title": "演员评价",
      "description": "演员对剧组的评价",
      "properties": {
        "score": {
          "bsonType": "int",
          "title": "评分",
          "description": "评分(1-5星)",
          "minimum": 1,
          "maximum": 5
        },
        "comment": {
          "bsonType": "string",
          "title": "评价内容",
          "description": "评价文字内容",
          "trim": "both"
        },
        "create_time": {
          "bsonType": "timestamp",
          "title": "评价时间",
          "description": "评价创建时间"
        }
      }
    }
  },
  "version": "1.0.0"
}
